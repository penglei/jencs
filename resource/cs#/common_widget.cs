<?cs include:"wupcs/modview/ugclib.cs" ?>

<?cs #{权限控制位 ?>
<?cs set:UGCFLAG_ALL_PUBLIC = 1?> <?cs #公开?>
<?cs set:UGCFLAG_QQFRIEND = 4?>  <?cs #QQ好友?>
<?cs set:UGCFLAG_WHITELIST = 16?> <?cs #指定人?>
<?cs set:UGCFLAG_ONLYSELF = 64?> <?cs #仅自己?>
<?cs #?>

<?cs #-------------------- ?>
<?cs #{qz_static_summary.cs}?>
<?cs #-------------------- ?>

<?cs set:qz_static_action[1] = '发表日志' ?>
<?cs set:qz_static_action[2] = '发表信纸日志' ?>
<?cs set:qz_static_action[3] = '转载' ?>
<?cs set:qz_static_action[4] = '转发：' ?>
<?cs set:qz_static_action[5] = '转发：' ?>
<?cs set:qz_static_action[6] = '发表魔方日志' ?>
<?cs set:qz_static_action[7] = '修改' ?>
<?cs set:qz_static_action[8] = '回复我的日志：' ?>
<?cs set:qz_static_action[9] = '评论我的日志：' ?>
<?cs set:qz_static_action[10] = '转发' ?>
<?cs set:qz_static_action[11] = '中上传照片' ?>
<?cs set:qz_static_action[12] = '用' ?>
<?cs set:qz_static_action[13] = '回复' ?>
<?cs set:qz_static_action[14] = '评论' ?>
<?cs set:qz_static_action[15] = '提到了我' ?>
<?cs set:qz_static_action[16] = '转了我的日志' ?>
<?cs set:qz_static_action[17] = '转了我的相册' ?>
<?cs set:qz_static_action[18] = '转了我的照片' ?>
<?cs set:qz_static_action[19] = '转发' ?>
<?cs set:qz_static_action[20] = '评论：' ?>
<?cs set:qz_static_action[21] = '转了我的说说：' ?>
<?cs set:qz_static_action[23] = '中提到我' ?>
<?cs set:qz_static_action[24] = '回复我' ?>
<?cs set:qz_static_action[25] = '转了提到我的说说：' ?>
<?cs set:qz_static_action[26] = '也转了' ?>
<?cs set:qz_static_action[27] = '回复了我的微博' ?>
<?cs set:qz_static_action[28] = '评论了我的微博' ?>
<?cs set:qz_static_action[29] = '更新相册' ?>
<?cs set:qz_static_action[30] = '评论了我的相册' ?>
<?cs set:qz_static_action[31] = '评论了我的照片' ?>
<?cs set:qz_static_action[32] = '回复' ?>
<?cs set:qz_static_action[33] = '转载我的照片' ?>
<?cs set:qz_static_action[34] = '转载照片' ?>
<?cs set:qz_static_action[35] = '上传照片' ?>

<?cs set:qz_static_action[37] = '制作动感影集：' ?>
<?cs set:qz_static_action[38] = '评论我的动感影集：' ?>
<?cs set:qz_static_action[39] = '装扮相册：' ?>
<?cs set:qz_static_action[40] = '圈圈评论' ?>
<?cs set:qz_static_action[41] = '收到对照片' ?>
<?cs set:qz_static_action[42] = '发表圈圈评论' ?>
<?cs set:qz_static_action[43] = '圈圈评论我' ?>
<?cs set:qz_static_action[44] = '回复我的喜欢' ?>
<?cs set:qz_static_action[45] = '评论我的喜欢' ?>
<?cs set:qz_static_action[46] = '喜欢了我的日志' ?>
<?cs set:qz_static_action[47] = '喜欢了我的相册' ?>
<?cs set:qz_static_action[48] = '喜欢了我的相片' ?>
<?cs set:qz_static_action[49] = '喜欢了我的' ?>
<?cs set:qz_static_action[50] = '签到：' ?>
<?cs set:qz_static_action[51] = '喜欢' ?>
<?cs set:qz_static_action[52] = '转播：' ?>
<?cs set:qz_static_action[53] = '喜欢了我的微博' ?>
<?cs set:qz_static_action[54] = '转了我的微博' ?>
<?cs set:qz_static_action[55] = '发起投票' ?>
<?cs set:qz_static_action[56] = '参与投票' ?>
<?cs set:qz_static_action[57] = '向你推荐' ?>
<?cs set:qz_static_action[58] = '回复：' ?>
<?cs set:qz_static_action[59] = '参与' ?>
<?cs set:qz_static_action[60] = '回复' ?>
<?cs set:qz_static_action[62] = '回复' ?>
<?cs set:qz_static_action[63] = ' 有了新评论' ?>
<?cs set:qz_static_action[64] = ' 收藏音乐：' ?>
<?cs set:qz_static_action[65] = ' 设置背景音乐：' ?>
<?cs set:qz_static_action[66] = '评论：' ?>
<?cs set:qz_static_action[67] = '回复：' ?>
<?cs set:qz_static_action[68] = '提到我：' ?>
<?cs set:qz_static_action[69] = '在评论中提到我：' ?>
<?cs set:qz_static_action[70] = '在回复中提到我：' ?>
<?cs set:qz_static_action[71] = '评论了提到我的说说：' ?>
<?cs set:qz_static_action[72] = ' 有了来自' ?>
<?cs set:qz_static_action[73] = '转了我的时光轴：' ?>
<?cs set:qz_static_action[74] = '评论：' ?>
<?cs set:qz_static_action[75] = '回复：' ?>
<?cs set:qz_static_action[76] = '提到我：' ?>
<?cs set:qz_static_action[77] = '在评论中提到我：' ?>
<?cs set:qz_static_action[78] = '在回复中提到我：' ?>
<?cs set:qz_static_action[79] = '评论：' ?>
<?cs set:qz_static_action[80] = '回复：' ?>
<?cs set:qz_static_action[81] = '在回复中提到我：' ?>
<?cs set:qz_static_action[82] = '在评论中提到我：' ?>
<?cs set:qz_static_action[83] = '提到我：' ?>
<?cs set:qz_static_action[84] = '上传照片到相册' ?>
<?cs set:qz_static_action[85] = '转歌单' ?>
<?cs set:qz_static_action[86] = '转专辑' ?>
<?cs set:qz_static_action[87] = '订阅了' ?>
<?cs set:qz_static_action[88] = '创建歌单' ?>
<?cs set:qz_static_action[89] = '添加了歌曲' ?>
<?cs set:qz_static_action[90] = '评论' ?>
<?cs set:qz_static_action[91] = '回复' ?>
<?cs set:qz_static_action[92] = '提到了我' ?>
<?cs set:qz_static_action[93] = '评论' ?>
<?cs set:qz_static_action[94] = '回复' ?>
<?cs set:qz_static_action[95] = '提到了我' ?>
<?cs set:qz_static_action[96] = '转给我：' ?>
<?cs set:qz_static_action[97] = '发了一条说说给我' ?>

<?cs set:qz_static_object[1]='的相册' ?>
<?cs set:qz_static_object[2]='的日志' ?>
<?cs set:qz_static_object[3]='的信纸日志' ?>
<?cs set:qz_static_object[4]='的微博' ?>
<?cs set:qz_static_object[5]='在相册' ?>
<?cs set:qz_static_object[6]='装扮相册' ?>
<?cs set:qz_static_object[7]='在分享' ?>

<?cs set:qz_static_object[8]='说说' ?>
<?cs set:qz_static_object[25]='签到' ?>
<?cs set:qz_static_action[36] = '' ?>

<?cs set:qz_static_object[9]='在' ?>
<?cs set:qz_static_object[10]='在微博' ?>
<?cs set:qz_static_object[11]='在照片' ?>
<?cs set:qz_static_object[12]='在照片活动：' ?>
<?cs set:qz_static_object[13]='上传的相册' ?>
<?cs set:qz_static_object[14]='在动感影集' ?>
<?cs set:qz_static_object[15]='的圈圈评论' ?>
<?cs set:qz_static_object[16]='在我的照片' ?>
<?cs set:qz_static_object[17]='的照片' ?>
<?cs set:qz_static_object[18]='在喜欢' ?>
<?cs set:qz_static_object[19]='上传的照片' ?>
<?cs set:qz_static_object[20]='的评论中提到我' ?>
<?cs set:qz_static_object[21]='的回复中提到我' ?>
<?cs set:qz_static_object[22]='说说' ?>
<?cs set:qz_static_object[23]='发起的投票' ?>
<?cs set:qz_static_object[24]='并说' ?>

<?cs set:qz_static_object[26]=' 的新评论' ?>
<?cs set:qz_static_object[27]='的歌单' ?>
<?cs set:qz_static_object[28]='的时光轴' ?>
<?cs set:qz_static_object[29]='说说' ?>
<?cs set:qz_static_object[30]='时光轴' ?>


<?cs #-------------------- ?>
<?cs #{macro.cs}?>
<?cs #-------------------- ?>

<?cs #:
	/**
	 * 对指定值做指定次数的htmlencode之后输出
	 * @param  {String} value 需要encode的值
	 * @param  {Number} time  次数
	 * @param  {Number} notprint  不直接打印出来，值为真时不打印，值为假时打印
	 * @return htmlEncodeVar_Res
	 */
	function htmlEncodeVar(value,time,notprint){}
?>
<?cs def:htmlEncodeVar(value,time,notprint) ?>
	<?cs if: time<=0 ?>
		<?cs set:time=1 ?>
	<?cs /if ?>
	<?cs set:htmlEncodeVar_Res=value ?>
	<?cs loop:i=1, time, 1 ?>
		<?cs set:htmlEncodeVar_Res=html_encode(htmlEncodeVar_Res,1) ?>
	<?cs /loop ?>
	<?cs if:notprint==0 ?>
		<?cs var:htmlEncodeVar_Res ?>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{writeUserName.cs}?>
<?cs #-------------------- ?>

<?cs def:writeUserName(uin,defaultName) ?>
	<?cs if:string.length(qz_metadata.remarkPool['u'+uin])>0 ?>
		<?cs var:html_encode(qz_metadata.remarkPool['u'+uin],1) ?>
	<?cs else ?>
		<?cs var:html_encode(defaultName, 1) ?>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{user_icon.cs}?>
<?cs #-------------------- ?>

<?cs def:getLogo_30(user,type) ?>
	<?cs if:user.type ?>
		<?cs set:uicon_type=user.type ?>
	<?cs else ?>
		<?cs set:uicon_type=type ?>
	<?cs /if ?>

	<?cs if:uicon_type==1 ?>
		<?cs if:string.length(qz_metadata.logoPool30['u'+user.uin])>0 ?>
			<?cs var:qz_metadata.logoPool30['u'+user.uin] ?>
		<?cs else ?>
			<?cs set:uinmod = user.uin % 4 + 1 ?>
			http://qlogo<?cs var:uinmod ?>.store.qq.com/qzone/<?cs var:user.uin ?>/<?cs var:user.uin ?>/30
		<?cs /if ?>
	<?cs elif:uicon_type==2 ?>
		<?cs if:string.length(qz_metadata.xylogoPool30['u'+user.uin])>0 ?>
			<?cs var:qz_metadata.xylogoPool30['u'+user.uin] ?>
		<?cs else ?>
			http://xy.store.qq.com/campus/<?cs var:user.img ?>/30
		<?cs /if ?>
	<?cs /if ?>
<?cs /def ?>

<?cs def:getLogo_50(uin,type) ?>
	<?cs if:user.type ?>
		<?cs set:uicon_type=user.type ?>
	<?cs else ?>
		<?cs set:uicon_type=type ?>
	<?cs /if ?>
	<?cs if:uicon_type==1 ?>
		<?cs if:string.length(qz_metadata.logoPool50['u'+user.uin])>0 ?>
			<?cs var:qz_metadata.logoPool50['u'+user.uin] ?>
		<?cs else ?>
			<?cs set:uinmod = user.uin % 4 + 1 ?>
			http://qlogo<?cs var:uinmod ?>.store.qq.com/qzone/<?cs var:user.uin ?>/<?cs var:user.uin ?>/50
		<?cs /if ?>
	<?cs elif:uicon_type==2 ?>
		<?cs if:string.length(qz_metadata.xylogoPool50['u'+user.uin])>0 ?>
			<?cs var:qz_metadata.xylogoPool50['u'+user.uin] ?>
		<?cs else ?>
			http://xy.store.qq.com/campus/<?cs var:user.img ?>/50
		<?cs /if ?>
	<?cs /if ?>
<?cs /def ?>


<?cs #:头像组件 ?>
<?cs #:参数user ?>
<?cs def:userIcon(user) ?>
	<?cs if:user.type == 1 ?><?cs #:Qzone用户 ?>
		<a href="http://user.qzone.qq.com/<?cs var:user.uin ?>" target="_blank">
			<img class="q_namecard" link="nameCard_<?cs var:user.uin ?> des_<?cs var:user.uin ?>" alt="<?cs call:writeUserName(user.uin,user.name) ?>" src="<?cs call:getLogo_30(user,1) ?>" />
		</a>
	<?cs elseif:user.type == 2 ?><?cs #:朋友用户 ?>
		<img alt="<?cs var:html_encode(user.name, 1) ?>" src="<?cs call:getLogo_30(user,2) ?>" />
	<?cs /if ?>
<?cs /def ?>
<?cs def:userIconStyle(user, style)?>
	<a href="http://user.qzone.qq.com/<?cs var:user.uin ?>" class="<?cs if:style == 'act'?>act_ava<?cs /if?>" target="_blank">
		<img class="q_namecard <?cs if:style == 'act'?>sslist_ava<?cs /if?>" link="nameCard_<?cs var:user.uin ?> des_<?cs var:user.uin ?>" alt="<?cs call:writeUserName(user.uin,user.name) ?>" src="<?cs call:getLogo_30(user,1) ?>" />
	</a>
<?cs /def?>


<?cs #-------------------- ?>
<?cs #{user_link.cs}?>
<?cs #-------------------- ?>

<?cs #:用户链接组件 ?>
<?cs #:prefix 是前缀啊例如@ ?>
<?cs def:userLink(user, prefix) ?>
	<?cs #:不想被展示的人disabled=1 ?>
	<?cs if: user.disabled!=1 ?>
		<?cs if:user.who == 1 || user.type == 1?>
			<a href="http://user.qzone.qq.com/<?cs var:user.uin ?>" class="q_namecard c_tx" link="nameCard_<?cs var:user.uin ?>" target="_blank">
			<?cs if:string.length(prefix) > 0 ?>
				<?cs var:prefix ?>
			<?cs /if ?>
			<span><?cs call:writeUserName(user.uin,user.name) ?></span></a>
		<?cs elif:user.who == 2 || user.type == 2 ?>
			<a href="http://profile.pengyou.qq.com/index.php?mod=profile&u=<?cs var:user.uin ?>" class="c_tx" target="_blank">
			<?cs if:string.length(prefix) > 0 ?>
				<?cs var:prefix ?>
			<?cs /if ?>
			<?cs var:html_encode(user.name, 1) ?></a>
		<?cs elif:user.who == 3 || user.type == 3 ?>
			<a href="http://rc.qzone.qq.com/myhome/weibo/profile/<?cs var:user.uin ?>" class="c_tx" target="_blank">
			<?cs if:string.length(prefix) > 0 ?>
				<?cs var:prefix ?>
			<?cs /if ?>
			<?cs var:html_encode(user.name, 1) ?></a>
		<?cs else ?>
			<?cs var:html_encode(user.name, 1) ?>
		<?cs /if ?>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{voice_cnt.cs}?>
<?cs #-------------------- ?>

<?cs def:voice_player(data)?>

<div class="qz_feed_plugin qz_shuoshuo_audio bor2 ui_mr5"<?cs #/*前台改变这个bor2 | bg_bor6*/?>
	 data-role="MoodRecord"
	 data-sourceid="<?cs var:data.id?>"
	 data-sourceurl="<?cs var:html_encode(data.url, 1)?>"
	 data-timelen="<?cs var:data.time_len?>">
	<div class="shuoshuo_audio_inner bg_bor2" style="width:0">
		<div class="audio_icon">
			<b class="icon_play bor_bg6"></b>
			<b class="icon_pause">
				<span class="icon_pause_left bor_bg6"></span>
				<span class="icon_pause_right bor_bg6"></span>
			</b>
		</div>
		<div class="audio_time">
			<span class="c_tx2"><?cs var:data.time_len?>&quot;</span>
		</div>
	</div>
</div>

<?cs /def?>

<?cs def:contentBox-block-voice()?>
	<?cs if:subcount(qz_metadata.content_box.voice) > 0?>
	<?cs if:!qz_metadata.content_box.voice_type?>
		<?cs with:voices=qz_metadata.content_box.voice?>

		<?cs if:subcount(voices.0)?>
			<?cs each:voice=voices?>
			<div class="audio_box">
				<?cs call:voice_player(voice)?>
			</div>
			<?cs /each?>
		<?cs else ?>
			<div class="audio_box">
			<?cs call:voice_player(voices)?>
			</div>
		<?cs /if?>

		<?cs /with?>
	<?cs /if?>
	<?cs /if?>
<?cs /def?>

<?cs def:contentBox-inline-voice()?>
	<?cs if:subcount(qz_metadata.content_box.voice) > 0?>
	<?cs if:qz_metadata.content_box.voice_type == 1?><?cs #在转发原文中(行内语音说说)?>
		<?cs with:voices=qz_metadata.content_box.voice?>
		<?cs if:subcount(voices.0)?>
			<?cs each:voice=voices?>
				<?cs call:voice_player(voice)?>
			<?cs /each?>
		<?cs else ?>
			<?cs call:voice_player(voices)?>
		<?cs /if?>
		<?cs /with?>
	<?cs /if?>
	<?cs /if?>
<?cs /def?>


<?cs #-------------------- ?>
<?cs #{gradestar.cs}?>
<?cs #-------------------- ?>

<?cs #公用得分组件?>
<?cs def:grade_star(item) ?>
	<?cs if:string.length(item.grade) > 0 || item.percent?>
	<p class="f_votestar">
		<span class="votestar">
		<?cs with:grade = item.grade ?>
		<?cs if:string.find(grade, ".")  != #-1 ?>
			<?cs set: item.grade = string.slice(grade,0,string.find(grade, "."))?>
		<?cs /if ?>
		<?cs /with?>

		<span class="<?cs if:item.grade || item.percent?>votestar_i <?cs /if ?>
			<?cs if:item.grade ?>star_<?cs var:item.grade?><?cs /if?>" style="<?cs if:item.percent?>width:<?cs var:item.percent?>;<?cs /if?>">
		</span>

		</span>
		<span class="votescore"><span class="c_tx3 ui_mr10"><?cs var:item.score ?></span></span>
	</p>
	<?cs /if ?>
<?cs /def?>


<?cs #-------------------- ?>
<?cs #{cmt_user_link.cs}?>
<?cs #-------------------- ?>

<?cs #:用户链接组件 ?>
<?cs #:prefix 是前缀啊例如@ ?>
<?cs def:cmtUserLink(user, prefix) ?>
	<?cs #:不想被展示的人disabled=1 ?>
	<?cs if:user.disabled!=1 ?>
		<?cs if:user.type == 1 ||user.who == 1?>
			<a href="http://user.qzone.qq.com/<?cs var:user.uin ?>" class="q_namecard nickname c_tx" link="nameCard_<?cs var:user.uin ?>" target="_blank">
			<?cs if:string.length(prefix) > 0 ?>
				<?cs var:prefix ?>
			<?cs /if ?>
			<?cs call:writeUserName(user.uin,user.name) ?></a>
		<?cs elif:user.who == 2 || user.type == 2 ?>
			<a href="http://profile.pengyou.qq.com/index.php?mod=profile&u=<?cs var:user.uin ?>" class="c_tx" target="_blank">
			<?cs if:string.length(prefix) > 0 ?>
				<?cs var:prefix ?>
			<?cs /if ?>
			<?cs var:html_encode(user.name, 1) ?></a>
		<?cs elif:user.who == 3 || user.type == 3 ?>
			<a href="http://rc.qzone.qq.com/myhome/weibo/profile/<?cs var:user.uin ?>" class="c_tx" target="_blank">
			<?cs if:string.length(prefix) > 0 ?>
				<?cs var:prefix ?>
			<?cs /if ?>
			<?cs var:html_encode(user.name, 1) ?></a>
		<?cs else ?>
			<?cs var:html_encode(user.name, 1) ?>
		<?cs /if ?>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{rich_content.cs}?>
<?cs #-------------------- ?>

<?cs #:富文本内容 ?>
<?cs def:richContent(cons) ?>

	<?cs def:richContent-items-sub(item) ?>
		<?cs if:item.type == 'nick' ?>
		<?cs elif:item.type == 'url' ?>
			<a class="c_tx" target="_blank" href="<?cs call:ugc_url_check(item.url,1) ?>"><?cs var:item.text?></a>
		<?cs else ?>
			<?cs var:item ?>
		<?cs /if ?>
	<?cs /def ?>

	<?cs def:richContent-items(item) ?>
		<?cs if:item.newsec ?><p><?cs /if?><?cs #换行 ?>
		<?cs if:item.type == 'nick' ?>
			<?cs call:userLink(item , '@') ?>
		<?cs elif:item.type == 'url' ?>
			<a class="c_tx" href="<?cs call:ugc_url_check(item.url,1) ?>" target="_blank"><?cs if:item.text ?><?cs var:item.text ?><?cs else ?><?cs var:item.url ?><?cs /if ?></a>
		<?cs elif:item.type == 'qz_app' ?><?cs #过时，等后台一起把它干掉 ?>
			<?cs if:string.length(item.title) > 0 ?>
			<p>
				<a class="c_tx" target="_blank" href="<?cs if: item.url ?><?cs call:ugc_url_check(item.url,1) ?><?cs else ?>http://rc.qzone.qq.com/myhome/<?cs var:item.id?><?cs /if ?>"><?cs var:item.title?></a>
			</p>
			<?cs /if ?>
			<?cs if:subcount(item.sub_content)>0?>
				<p class="c_tx3"><?cs var:item.text?></p>
				<p>
					<?cs each:item=item.sub_content.con ?>
						<?cs call:richContent-items-sub(item) ?>
					<?cs /each ?>
				</p>
			<?cs elif:string.length(item.text)?>
				<p><?cs var:item.text?></p>
			<?cs /if?>
			<?cs call:grade_star(item) ?>
		<?cs elif:item.type == 'btn' ?>
				<a class="f_act_bt" href="<?cs call:ugc_url_check(item.url,1) ?>" target="_blank"><?cs var:item.text?></a>
		<?cs elif:item.type == 'text' ?>
			<?cs var:item.text ?>
		<?cs else ?>
			<?cs var:item ?>
		<?cs /if ?>
		<?cs if:item.newsec ?></p><?cs /if?>
	<?cs /def ?>
	<?cs if:cons.con.0 || subcount(cons.con.0) > 0 || string.length(cons.con.0) > 0 ?>
		<?cs loop:i = 0, subcount(cons.con) - 1, 1 ?>
			<?cs call:richContent-items(cons.con[i]) ?>
		<?cs /loop ?>
	<?cs elif:cons.con || subcount(cons.con) > 0 || string.length(cons.con) > 0 ?>
			<?cs call:richContent-items(cons.con) ?>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{opr.cs}?>
<?cs #-------------------- ?>

<?cs #:转发参数 ?>
<?cs #:构造转发的param数据，评论回复支持转发的话，无法每条评论回复都冗余出那么大一坨转发信息 ?>
<?cs #:fwdtype 转发类型，0-转发主贴 1-转发评论 2-转发回复  fwdtype ?>
<?cs def:buildForwardParam(fwdtype,comment,reply) ?>
	<?cs #:这里为该死的转发框弄多个方法，转多一次 ?>
	<?cs def:writeUserName_forwad(uin,defaultName) ?>
		<?cs if:string.length(qz_metadata.remarkPool['u'+uin])>0 ?>
			<?cs escape:'js' ?><?cs var:html_encode(html_encode(qz_metadata.remarkPool['u'+uin],1), 1) ?><?cs /escape ?>
		<?cs else ?>
			<?cs escape:'js' ?><?cs var:html_encode(html_encode(defaultName, 1), 1) ?><?cs /escape ?>
		<?cs /if ?>
	<?cs /def ?>
	<?cs def:fillNum(num) ?>
		<?cs if:num ?>
			<?cs var:num ?>
		<?cs else ?>
			<?cs var:0 ?>
		<?cs /if ?>
	<?cs /def ?>
	<?cs def:setForwardCount(n,m) ?>
		<?cs if:n>0 ?>
			<?cs var:n ?>
		<?cs elif:m>0 ?>
			<?cs var:m ?>
		<?cs else ?>
			0
		<?cs /if ?>
	<?cs /def ?>
		<?cs def:fillContent(content) ?>
		<?cs def:setContent(con) ?>
			<?cs if:con.type == "url"?>
				<?cs escape:'html' ?><?cs var:json_encode(con.text, 1) ?><?cs /escape ?>
			<?cs elif:con.type == "text"?>
				<?cs escape:'html' ?><?cs var:json_encode(con.text, 1) ?><?cs /escape ?>
			<?cs elif:con.type == "nick" ?>
				@{uin:<?cs var:con.uin ?>,nick:<?cs escape:'html' ?><?cs call:writeUserName_forwad(con.uin, con.name)?><?cs /escape ?>}
			<?cs elif:con.type == "qz_app" ?>
				<?cs escape:"html" ?><?cs var:json_encode(con.text, 1) ?><?cs /escape ?>
			<?cs elif:con.type == 'script' ?>
				<?cs if:con.biz == "mall"?>
					<?cs escape:"html" ?><?cs var:json_encode(con.text, 1) ?><?cs /escape ?>
				<?cs /if ?>
			<?cs else ?>
				<?cs escape:"html" ?><?cs var:json_encode(con, 1) ?><?cs /escape ?>
			<?cs /if ?>
		<?cs /def ?>
		restHTML('
		<?cs if:content.con.0||subcount(content.con.0)>0 ?>
			<?cs loop:i =0, subcount(content.con), 1 ?>
				<?cs call:setContent(content.con[i]) ?>
			<?cs /loop ?>
		<?cs elif:content.con||subcount(content.con)>0 ?>
			<?cs call:setContent(content.con) ?>
		<?cs /if ?>
		')
	<?cs /def ?>
	<?cs if:!fwdtype ?>
		<?cs set:fwdtype=0 ?>
	<?cs /if ?>
	{
		id:'<?cs var:qz_metadata.metadata.blogid ?>',
		poster:{
			uin:'<?cs var:qz_metadata.metadata.uin ?>',
			nickname:restHTML('<?cs escape:'html' ?><?cs call:writeUserName_forwad(qz_metadata.metadata.uin,qz_metadata.metadata.mood_uinnickname) ?><?cs /escape ?>')},
			owner:{
				uin:'<?cs var:qz_metadata.metadata.orguin ?>',
				nickname:restHTML('<?cs escape:'html' ?><?cs call:writeUserName_forwad(qz_metadata.metadata.uin,qz_metadata.metadata.orgname) ?><?cs /escape ?>')
			},
			content:<?cs call:fillContent(qz_metadata.actiontitle.content) ?>,
			rt_content:restHTML('<?cs escape:'html' ?><?cs var:json_encode(qz_metadata.metadata.rt_content, 1) ?><?cs /escape ?>'),
			source:'<?cs var:qz_metadata.metadata.mood_source ?>',
			retweetListInfo:{
				tid:'<?cs var:qz_metadata.metadata.blogid ?>',
				uin:'<?cs var:qz_metadata.metadata.uin ?>',
				pfType:<?cs call:fillNum(qz_metadata.metadata.mood_source) ?>,
				rtTid:'<?cs var:qz_metadatika.metadata.orgid ?>',
				rtUin:<?cs call:fillNum(qz_metadata.metadata.orguin) ?>,
				rtPfType:<?cs call:fillNum(qz_metadata.metadata.orgpfid) ?>,
				totalForShow:<?cs call:setForwardCount(qz_metadata.qz_data.key2.ZS.cnt,qz_metadata.qz_data.key1.ZS.cnt) ?>,
				hasToWeibo:<?cs call:fillNum(qz_metadata.metadata.to_tweet) ?><?cs if:fwdtype>0 ?>,
				commentInfo:{
					poster:{
						uin:'<?cs var:comment.user.uin ?>',
						nickname:restHTML('<?cs escape:'html' ?><?cs call:writeUserName_forwad(comment.user.uin,comment.user.name) ?><?cs /escape ?>')
					},
					tid:'<?cs var:comment.commentid ?>',
					uin:'<?cs var:comment.user.uin ?>',
					nickname:restHTML('<?cs escape:'html' ?><?cs call:writeUserName_forwad(comment.user.uin,comment.user.name) ?><?cs /escape ?>'),
					reply_num:<?cs call:fillNum(comment.totalreply) ?>,
					content:<?cs call:fillContent(comment.content) ?><?cs if:fwdtype==2 ?>,
					replyInfo:{
						poster:{
							uin:'<?cs var:reply.user.uin ?>',
							nickname:restHTML('<?cs escape:'html' ?><?cs call:writeUserName_forwad(reply.user.uin,reply.user.name) ?><?cs /escape ?>')
						},
						tid:'<?cs var:reply.replyid ?>',
						uin:'<?cs var:reply.user.uin ?>',
						nickname:restHTML('<?cs escape:'html' ?><?cs call:writeUserName_forwad(reply.user.uin,replu.user.name) ?><?cs /escape ?>'),
						content:<?cs call:fillContent(reply.content) ?>
					}<?cs /if ?>
				}<?cs /if ?>
			},
			isSignIn:<?cs call:fillNum(qz_metadata.metadata.signin) ?>,
			fwdtype:<?cs call:fillNum(fwdtype) ?><?cs if:fwdtype>0 ?>,
			t2_tid:'<?cs var:comment.commentid ?>'<?cs /if ?><?cs if:fwdtype==2 ?>,
			t3_tid:'<?cs var:reply.replyid ?>'<?cs /if ?>
		}
<?cs /def ?>

<?cs #:fwdtype 转发类型，0-分享主贴 1-分享评论 2-分享回复  fwdtype ?>
<?cs def:buildReshareParam(fwdtype,comment,reply) ?>
	<?cs def:fillContent_buildReshareParam(content) ?>
		<?cs def:setContent_buildReshareParam(con) ?>
			<?cs if:con.type == "url"?>
				<?cs escape:"html" ?><?cs var:con.text ?><?cs /escape ?>
			<?cs elif:con.type == "text"?>
				<?cs escape:"html" ?><?cs var:con.text ?><?cs /escape ?>
			<?cs elif:con.type == "nick" ?>
				<?cs escape:"html" ?>@{uin:<?cs var:con.uin ?>,nick:<?cs call:writeUserName(con.uin, con.name)?>,who:<?cs var:con.who ?>}<?cs /escape ?>
			<?cs else ?>
				<?cs escape:"html" ?><?cs var:uri_encode(con) ?><?cs /escape ?>
			<?cs /if ?>
		<?cs /def ?>
		<?cs if:content.con.0||subcount(content.con.0)>0 ?>
			<?cs loop:i =0, subcount(content.con), 1 ?>
				<?cs call:setContent_buildReshareParam(content.con[i]) ?>
			<?cs /loop ?>
		<?cs elif:content.con||subcount(content.con)>0 ?>
			<?cs call:setContent_buildReshareParam(content.con) ?>
		<?cs /if ?>
	<?cs /def ?>

	&plusdescription=
	<?cs if:fwdtype == 2 ?>
		||<?cs escape:"html" ?>@{uin:<?cs var:reply.user.uin ?>,nick:<?cs var:reply.user.name ?>,who:<?cs var:reply.user.type ?>}<?cs /escape ?>:<?cs call:fillContent_buildReshareParam(reply.content) ?>
	<?cs /if ?>
	<?cs if:fwdtype == 1 || fwdtype == 2 ?>
		||<?cs escape:"html" ?>@{uin:<?cs var:comment.user.uin ?>,nick:<?cs var:comment.user.name ?>,who:<?cs var:comment.user.type ?>}<?cs /escape ?>:<?cs call:fillContent_buildReshareParam(comment.content) ?>
	<?cs /if ?>
<?cs /def ?>

<?cs #:操作行 ?>
<?cs def:privacy-icon()?>
	<?cs #这是相册的老权限?>
	<?cs if:qz_metadata.metadata.appid == 4?>
		<?cs if:qz_metadata.metadata.privacy == 6 ?><?cs #指定好友可见?>
			<i class="ui_icon icon_gray_lock" title="指定好友可见"></i>
		<?cs elif:qz_metadata.metadata.privacy == 2 || qz_metadata.metadata.privacy == 5?>
			<i class="ui_icon icon_gray_lock" title="已回答过问题可见"></i>
		<?cs /if?>
	<?cs else ?>
		<?cs with:privacy = qz_metadata.metadata.privacy?>
		<?cs if:qz_metadata.metadata.appid == 311 ?>
			<?cs if:privacy == UGCFLAG_WHITELIST ?>
				<i class="ui_icon icon_gray_lock" title="指定好友可见"></i>
			<?cs elif:privacy == UGCFLAG_ONLYSELF?>
				<i class="ui_icon icon_gray_lock" title="仅自己可见"></i>
			<?cs /if?>
		<?cs /if?>
		<?cs /with?>
	<?cs /if?>
<?cs /def?>

<?cs def:opr(mod) ?>
	<?cs def:opr-btn-like(mod) ?>
		<?cs #:key2:源key key1:节点key ?>
		<?cs if:mod.like == 'on' ?>
			<a class="qz_like_btn_v2 c_tx ui_mr10" href="javascript:;"></a>
		<?cs /if ?>
		<?cs #:<a class="qz_like_btn_v2 c_tx ui_mr10 none" href="javascript:;"></a> ?>
	<?cs /def ?>

	<?cs def:time(mod) ?>
		<?cs if:subcount(qz_metadata.time) > 0 || qz_metadata.time.text ?>
			<span class="ui_mr10"><?cs var:qz_metadata.time.qz_text ?></span>
		<?cs /if ?>
	<?cs /def ?>

	<?cs def:btn(mod) ?>
		<?cs def:setCount(n,m) ?>
			<?cs if:n>0 || m>0 ?>(<?cs var:0+n+m ?>)<?cs /if ?>
		<?cs /def ?>
		<?cs if:qz_metadata.qz_data.key2.LIKE.cnt>0 ?>
			<?cs set:qz_data_key='key2' ?>
			<?cs elif:qz_metadata.qz_data.key1.LIKE.cnt>0 ?>
				<?cs set:qz_data_key='key1' ?>
			<?cs else ?>
				<?cs set:qz_data_key='key2' ?>
			<?cs /if ?>
		<?cs def:randerLike(mod) ?>
			<?cs if:qz_metadata.qz_data.version==1 && !qz_metadata.accessright&&mod.like=='on' ?>
				<?cs if:qz_metadata.qz_data.key2 ?>
					<?cs set:unikey=qz_metadata.qz_data.key2 ?>
				<?cs elif:qz_metadata.qz_data.key1 ?>
					<?cs set:unikey=qz_metadata.qz_data.key1 ?>
				<?cs /if ?>
				<?cs if:subcount(qz_metadata.qz_data[qz_data_key].LIKE.user)>0 ?>
					<?cs set:likeinfo=subcount(qz_metadata.qz_data[qz_data_key].LIKE.user) ?>
					<?cs if:likeinfo>6 ?>
						<?cs set:likeinfo=6 ?>
					<?cs /if ?>
				<?cs elif:subcount(qz_metadata.qz_data[qz_data_key].LIKE.user[0]) ?>
					<?cs set:likeinfo = 1 ?>
				<?cs else ?>
					<?cs set:likeinfo = 0 ?>
				<?cs /if ?>
				<?cs if:qz_metadata.qz_data[qz_data_key].LIKE.isliked==1 && string.length(qz_metadata.qz_data.key1)>0 ?>
					<a class="qz_like_btn_v3 c_tx ui_mr10 _likeBtn" 
						data-islike="<?cs var:qz_metadata.qz_data[qz_data_key].LIKE.isliked||'0' ?>" 
						data-likecnt="<?cs alt:qz_metadata.qz_data[qz_data_key].LIKE.cnt ?>0<?cs /alt ?>" 
						data-showcount="<?cs var:likeinfo ?>" 
						data-unikey="<?cs var:unikey ?>" 
						data-curkey="<?cs var:qz_metadata.qz_data.key1 ?>" 
						href="javascript:;"
					>
						取消赞
						<?cs call:setCount(qz_metadata.qz_data.key2.LIKE.cnt,qz_metadata.qz_data.key1.LIKE.cnt) ?>
					</a>
				<?cs elif:string.length(qz_metadata.qz_data.key1)>0 ?>
					<a class="qz_like_btn_v3 c_tx ui_mr10 _likeBtn" 
					data-islike="<?cs var:qz_metadata.qz_data[qz_data_key].LIKE.isliked||'0' ?>" 
					data-likecnt="
						<?cs if:qz_metadata.qz_data[qz_data_key].LIKE.cnt ?>
						<?cs var:qz_metadata.qz_data[qz_data_key].LIKE.cnt ?>
						<?cs else ?>0<?cs /if ?>" 
					data-showcount="<?cs var:likeinfo ?>" 
					data-unikey="<?cs var:unikey ?>" 
					data-curkey="<?cs var:qz_metadata.qz_data.key1 ?>" 
					href="javascript:;">
						赞<?cs call:setCount(qz_metadata.qz_data.key2.LIKE.cnt,qz_metadata.qz_data.key1.LIKE.cnt) ?>
					</a>
				<?cs /if ?>
			<?cs /if ?>
		<?cs /def ?>

		<?cs def:btn-reply(item) ?>
			<a class="c_tx ui_mr10 qz_btn_reply" href="javascript:;"
				 data-cmd="qz_reply"
				<?cs #:如果有展开更多,就变成More Btn 这里和comments耦合了.?>
				 <?cs if:(qz_metadata.totalcomment > 3 || qz_metadata.noreply) &&
						 qz_metadata.comments.qz_more.action?>
				 data-role="more"<?cs #同时展开更多?>
				 <?cs /if?>
				 data-link="1"
				 data-version="6.3"
			>
				评论<?cs call:setCount(qz_metadata.totalcomment,0) ?>
			</a>
		<?cs /def ?>
		<?cs def:setText(t) ?>
			<?cs if:t=='转载'?>
				转载<?cs if:qz_metadata.qz_data.key1.ZZ.cnt>0 ?><?cs call:setCount(qz_metadata.qz_data.key2.ZZ.cnt,qz_metadata.qz_data.key1.ZZ.cnt) ?><?cs /if ?>
			<?cs elif:t=="我也要参与"||t=='参与' ?>
				参与<?cs if:qz_metadata.qz_data.key1.ACT.cnt>0 ?><?cs call:setCount(qz_metadata.qz_data.key2.ACT.cnt,qz_metadata.qz_data.key1.ACT.cnt) ?><?cs /if ?>
			<?cs else ?>
				<?cs var:t ?>
			<?cs /if ?>
		<?cs /def ?>
		<?cs def:btn-items(item) ?>
			<?cs if:item.type == 1 ?><?cs #:评论 ?>
				<?cs call:btn-reply(item) ?>
			<?cs elif:item.type == 2 ?><?cs #:转发 ?>
				<a 
					data-cmd="qz_popup"  
					href="javascript:void(0)" 
					data-version="4" 
					data-isnewtype="1" 
					data-type="ForwardingBox" 
					data-needcontainer="1" 
					<?cs if:(qz_metadata.metadata.appid == 311 && (privacy == UGCFLAG_WHITELIST || privacy == UGCFLAG_ONLYSELF)) ||
							(qz_metadata.metadata.appid == 4 && qz_metadata.metadata.privacy == 6)?>
						data-fwddenied=1 
					<?cs /if?>
					data-src="/qzone/app/controls/forwardingBox/forwardingBoxFacade.js" 
					class="c_tx ui_mr10" 
					data-link="/qzonestyle/qzone_app/app_feeds_v1/mood_feeds.css">
					转发<?cs if:qz_metadata.metadata.appid == 311?>
							<?cs call:setCount(qz_metadata.qz_data.key1.ZS.cnt, 0)?>
						<?cs else ?>
							<?cs call:setCount(qz_metadata.qz_data.key1.SJDP, qz_metadata.qz_data.key1.SJDQ.cnt)?>
						<?cs /if?>
				</a>
			<?cs elif:item.type == 3 ?><?cs #:分享 ?>
				<a 
					data-cmd="qz_popup"  
					href="javascript:void(0)" 
					data-version="4" 
					data-isnewtype="1" 
					data-type="ForwardingBox" 
					data-src="/qzone/app/controls/forwardingBox/forwardingBoxFacade.js" 
					class="c_tx ui_mr10" 
					<?cs if:(qz_metadata.metadata.appid == 311 && (privacy == UGCFLAG_WHITELIST || privacy == UGCFLAG_ONLYSELF || privacy == UGCFLAG_QQFRIEND )) ||
							(qz_metadata.metadata.appid == 4 && qz_metadata.metadata.privacy == 6)?>
						data-fwddenied=1 
					<?cs /if?>
					data-link="/qzonestyle/qzone_app/app_feeds_v1/mood_feeds.css"
					data-param="<?cs var:item.qz_popup.param ?>" >
					转发<?cs call:setCount(qz_metadata.qz_data.key1.ZF.cnt,0) ?>
				</a>
			<?cs elif:item.type == 4 ?><?cs #:动作是js脚本 ?><?cs #目前只有v6升级在用，2012年把它干掉 ?>
				<a class="c_tx ui_mr10" href="javascript:;" onclick="<?cs var:item.javascript ?>"><?cs call:setText(item.text) ?></a>
			<?cs elif:item.type == 5 ?><?cs #:转播 ?>
				<a 
					data-cmd="qz_popup" 
					href="javascript:void(0)" 
					data-version="4" 
					data-type="<?cs var:item.qz_popup.type ?>" 
					data-param="<?cs var:item.qz_popup.param ?>" 
					data-needcontainer="<?cs var:item.qz_popup.needcontainer ?>" 
					data-src="<?cs var:item.qz_popup.src ?>" 
					data-link="<?cs var:item.qz_popup.link ?>" 
					data-charset="<?cs var:item.qz_popup.charset ?>" 
					class="c_tx ui_mr10" 
					title="<?cs var:item.qz_popup.title ?>">
					转播<?cs call:setCount(qz_metadata.qz_data.key2.WBZB.cnt,qz_metadata.qz_data.key1.WBZB.cnt) ?>
				</a>
			<?cs elif:item.type == 6 ?><?cs #:更多 ?>
				<a class="ui_mr10 c_tx" href="<?cs call:ugc_url_check(item.action,1) ?>'" target="_blank">查看更多微博</a>
			<?cs elif:item.type == '101' ?>
				<a class="ui_mr10 c_tx" href="<?cs call:ugc_url_check(item.url,1) ?>"  target="_blank" ><?cs call:setText(item.text) ?></a>
			<?cs elif:item.type == 'url' ?>
				<a class="ui_mr10 c_tx" href="<?cs call:ugc_url_check(item.url,1) ?>"  target="_blank" ><?cs call:setText(item.text) ?></a>
			<?cs elif:item.type == 'qz_popup' ?>
				<a 
					data-cmd="qz_popup" 
					href="javascript:void(0)" 
					title="<?cs var:item.qz_popup.title ?>" 
					data-height="<?cs var:item.qz_popup.height ?>" 
					data-width="<?cs var:item.qz_popup.width ?>" 
					data-version="<?cs var:item.qz_popup.version ?>" 
					data-src="<?cs var:item.qz_popup.src ?>" 
					class="c_tx ui_mr10" 
					data-param="<?cs var:item.qz_popup.param ?>"><?cs call:setText(item.text) ?>
				</a>
			<?cs elif:item.type == "checkin"?>
				<a 
					data-cmd="qz_popup" 
					href="javascript:void(0)" 
					data-src="/qzone/app/mood/info/checkin.html" 
					data-width="318" 
					data-height="400" 
					data-version ="5" 
					class="c_tx ui_mr10" 
					data-config="id:checkin|closeButtonColor:#D4CFC2;font-weight:400;|arrowOffset:10|noflush:true">
					我也签到
				</a>
			<?cs elif:item.type == "qz_app"?>
				<?cs if:item.aid == "appsetup"?>
					<a class="ui_mr10 c_tx" href="http://rc.qzone.qq.com/appsetup"><?cs call:setText(item.text) ?></a>
				<?cs else ?>
					
					<a class="ui_mr10 c_tx" target="_blank" href="<?cs if: item.url ?><?cs call:ugc_url_check(item.url,1) ?><?cs else ?>http://rc.qzone.qq.com/myhome/<?cs var:item.aid?><?cs /if ?>">
						<?cs call:setText(item.text) ?>
					</a>
				<?cs /if ?>
			<?cs elif:item.type == "specialcare" ?><? #:特别关心 ?>
				<?cs if:item.text ?><span class="mr8 c_tx3"><?cs var:item.text ?></span><?cs /if ?>
				<a href="<?cs call:ugc_url_check(item.url.src,1) ?>" class="mr8" title="<?cs var:item.url.text ?>"><?cs var:item.url.text ?></a>
			<?cs elif:item.type == "visitor" ?>

				<?cs if:qz_metadata.metadata.appid == 4 ?>
					<?cs if:qz_metadata.qz_data.version!=1 ?>
						<a class="ui_mr10 c_tx" href="javascript:;" 
							config="9;<?cs var:qz_metadata.content_box.media.albumid ?>%7C
							<?cs if:subcount(qz_metadata.content_box.media.media.0) > 0 ?>
								<?cs var:qz_metadata.content_box.media.media.0.largeid ?>
							<?cs else ?>
								<?cs var:qz_metadata.content_box.media.media.largeid ?>
							<?cs /if ?>" 
							uin="<?cs var:qz_metadata.metadata.uin ?>"
						>浏览</a>
					<?cs elif:qz_metadata.qz_data.key1.PRD.cnt>0 ?>
						<qz:plugin name="Visitor" 
							config="<?cs var:qz_metadata.metadata.appid ?>|9;
							<?cs var:qz_metadata.content_box.media.albumid ?>%7C
							<?cs if:subcount(qz_metadata.content_box.media.media.0) > 0 ?>
								<?cs var:qz_metadata.content_box.media.media.0.largeid ?>
							<?cs else ?>
								<?cs var:qz_metadata.content_box.media.media.largeid ?>
							<?cs /if ?>
								|
							<?cs var:qz_metadata.metadata.uin ?>" >
								<a class="ui_mr10 c_tx" href="javascript:;">
									浏览
									<?cs call:setCount(qz_metadata.qz_data.key1.PRD.cnt,0) ?>
								</a>
						</qz:plugin>
					<?cs /if ?>
				<?cs elif:qz_metadata.metadata.appid == 2 ?>
					<?cs if:qz_metadata.qz_data.version!=1 ?>
						<a class="ui_mr10 c_tx" href="javascript:;" 
							config="<?cs var:qz_metadata.metadata.blogid ?>" 
							uin="<?cs var:qz_metadata.metadata.uin ?>"
						>浏览</a>
					<?cs elif:qz_metadata.qz_data.key1.RZRD.cnt>0 ?>
						<qz:plugin name="Visitor" 
							config="<?cs var:qz_metadata.metadata.appid ?>|
							<?cs if:qz_metadata.metadata.appid == 2?>
								<?cs var:qz_metadata.metadata.blogid ?>
							<?cs else ?>
								<?cs var:qz_metadata.qz_data.likedid?>
							<?cs /if?>
							|<?cs var:qz_metadata.metadata.uin ?>" >
							<a class="ui_mr10 c_tx" href="javascript:;">
								浏览<?cs call:setCount(qz_metadata.qz_data.key1.RZRD.cnt,0) ?>
							</a>
						</qz:plugin>
					<?cs /if ?>
				<?cs else ?>
					<qz:plugin name="Visitor" 
						config="<?cs var:qz_metadata.metadata.appid ?>|
							<?cs var:qz_metadata.metadata.blogid ?>
						|<?cs var:qz_metadata.metadata.uin ?>" >
						<a class="ui_mr10 c_tx" href="javascript:;">
							浏览<?cs call:setCount(qz_metadata.qz_data.key1.PRD.cnt,0) ?>
						</a>
					</qz:plugin>
				<?cs /if ?>
			<?cs elif:item.type == 'script'?>
				<?cs if:item.biz == 'mall' ?>
					<a class="c_tx ui_mr10" href="javascript:;" 
					onclick="QZONE.ICFeeds.Interface.checkForDress2(this,
							'<?cs var:item.param[0]?>',
							'<?cs var:item.param[1] ?>')"
					>
						<?cs call:setText(item.text) ?>
					</a>
				<?cs elif:item.biz == 'lookaround' ?>
					<a class="c_tx ui_mr10" href="javascript:;" onclick="QZONE.ICPlugin.LookAround.showDialog();return false;">随便看看</a>
				<?cs /if ?>
			<?cs elif:item.type == 'dress' ?><?cs #已经转移到item.type == 'script' && item.biz == 'mall'.@2012可以删除 ?>
				<a class="ui_mr10 c_tx"
					 href="javascript:;"
					 onclick="return QZONE.ICFeeds.Interface.checkForDress(this,
										'<?cs var:qz_metadata.metadata.uin ?>',
										'<?cs var:qz_metadata.metadata.blogid ?>',
										<?cs var:qz_metadata.metadata.srctype ?>)"
				>
					<?cs call:setText(item.text) ?>
				</a>
			<?cs elif:item.type == 'like'?>
				<a class="ui_mr10 c_tx"
					 href="javascript:;"
					  onclick="g_Parent.QZONE.FrontPage.addILike(
									'<?cs var:item.uin ?>',
									function(o){
										if(o.ret==-20){
											g_Parent.QZONE.FrontPage.showMsgbox('您已经关注此空间，请勿重复操作。',0,2000)}
											if(!o.ret){
												g_Parent.QZONE.FrontPage.showMsgbox('关注成功', 4, 2000)
											}
										},
										{scene:1});return false;"
					 title='点击"我也关注",即可在个人中心收取该空间动态'
				>
					 <?cs call:setText(item.text) ?>
				</a>
			<?cs /if ?>
		<?cs /def ?>
		<?cs if:subcount(qz_metadata.operate.opt.0) > 0 ?>
			<?cs call:randerLike(mod) ?>
			<?cs each:item=qz_metadata.operate.opt ?>
				<?cs call:btn-items(item) ?>
			<?cs /each ?>
		<?cs else  ?>
			<?cs call:randerLike(mod) ?>
			<?cs call:btn-items(qz_metadata.operate.opt) ?>
		<?cs /if ?>
	<?cs /def ?>

	<?cs def:oprModCaller(mods) ?>
		<?cs each:mod = mods ?>
			<?cs if:mod.name == "time" ?>
				<?cs call:time(mod) ?>
			<?cs /if ?>
			<?cs if:mod.name == "source" ?>
				<?cs include:"opr_source.cs"?>
			<?cs /if ?>
			<?cs if:mod.name == "btn" ?>
				<span class='feeds_tp_operate_v2 f_detail_op'>
				<?cs call:btn(mod) ?>
				</span>
			<?cs /if ?>
		<?cs /each ?>
		<?cs #权限feeds加锁图标提示?>
		<?cs call:privacy-icon()?>
	<?cs /def ?>
	<p class="f_detail c_tx3">
	<?cs call:oprModCaller(mod.mod) ?>
	</p>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{sub_title.cs}?>
<?cs #-------------------- ?>

<?cs #:Feed整块内容区的标题 ?>
<?cs def:subTitle() ?>
<?cs if:(qz_metadata.qz_data.feedtype!=1||qz_metadata.metadata.appid==7005) && subcount(qz_metadata.content_box.subtitle) > 0?>
	<?cs def:subTitle-item(con)?>
		<?cs if:con.type == "nick"?>
			<?cs set:con.type = 1?>
			<?cs call:userLink(con, '')?>
		<?cs elif:con.type == "text"?>
			<?cs escape:"html" ?><?cs var:con.text ?><?cs /escape ?>
		<?cs elif:con.type == "url"?>
			<a class="c_tx ui_mr5 " href="<?cs call:ugc_url_check(con.url,1) ?>" target="_blank"><?cs if:con.text ?><?cs escape:"html" ?><?cs var:con.text ?><?cs /escape ?><?cs else ?><?cs var:con.url ?><?cs /if ?></a>
		<?cs elif:con.type == "p"?>
			<p><?cs escape:"html" ?><?cs var:con ?><?cs /escape ?></p>
		<?cs elif:con.type == "p_url"?>
			<p><a class="c_tx ui_mr5 " href="<?cs call:ugc_url_check(con.url,1) ?>" target="_blank"><?cs if:con.text ?><?cs escape:"html" ?><?cs var:con.text ?><?cs /escape ?><?cs else ?><?cs var:con.url ?><?cs /if ?></a><p>
		<?cs else ?>
			<span class="ui_mr5"><?cs var:con ?></span>
		<?cs /if?>
	<?cs /def?>
	<?cs with:st = qz_metadata.content_box.subtitle?>
	<p class="f_ct_title">

		<?cs #:这里显示源作者 ?>
		<?cs if:subcount(st.orginuser) > 0 ?>
			<span class="c_tx3 ui_mr5"><?cs call:userLink(st.orginuser, '') ?></span>
		<?cs /if ?>

		<?cs if:st.action.no > 0 ?>
			<?cs set:qz_subtitle_actionWord = qz_static_action[st.action.no] ?>
			<?cs if:string.slice(qz_subtitle_actionWord, string.length(qz_subtitle_actionWord)-3, string.length(qz_subtitle_actionWord)) == "："  ?>
				<span class="c_tx3">
			<?cs else ?>
				<span class="ui_mr5 c_tx3">
			<?cs /if ?>
			<?cs var:qz_subtitle_actionWord ?></span>
		<?cs /if ?>

		<?cs if:subcount(st.con.0) || st.con.0 ?>
			<?cs loop:i = 0, subcount(st.con) - 1, 1 ?>
				<?cs call:subTitle-item(st.con[i])?>
			<?cs /loop ?>
		<?cs else ?>
			<?cs call:subTitle-item(st.con)?>
		<?cs /if?>
	</p>
	<?cs /with?>
<?cs /if?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{quote.cs}?>
<?cs #-------------------- ?>

<?cs #:引用组件 ?>
<?cs def:quote(mod) ?>
	<?cs if:subcount(qz_metadata.quote) > 0 && (subcount(qz_metadata.quote.con)>0 || string.length(qz_metadata.quote.con) > 0)?>
		<div class="f_quote"><i class="ui_ico quote_before c_tx3">“</i><?cs call:richContent(qz_metadata.quote) ?><i class="ui_ico quote_after c_tx3">”</i></div>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{vote_viewer.cs}?>
<?cs #-------------------- ?>

<?cs #:投票组件  ?>
<?cs def:voteViewer(mod) ?>
<?cs if:subcount(qz_metadata.vote_box) > 0 ?>
<?cs with:voteBox = qz_metadata.vote_box ?>
<?cs set:qz_votebox_mainpic = 0?>
<?cs if:subcount(voteBox.mainpic) > 0?>
	<?cs set:qz_votebox_mainpic = 1 ?>
<?cs /if ?>
<?cs set:qz_votebox_isvideo = 0?>
<?cs if:voteBox.votetype == 1?>
	<?cs set:qz_votebox_isvideo = 1?>
<?cs /if?>
<qz:plugin name="Vote" config="topicid=<?cs var:qz_metadata.vote_box.topicid?>&owneruin=<?cs var:qz_metadata.vote_box.owner?>&voteid=<?cs var:qz_metadata.vote_box.id?>">
	<div class="qz_vote vote-feed-container" 
		data-owner="<?cs var:qz_metadata.vote_box.owner?>" 
		data-haspic="<?cs var:qz_votebox_mainpic?>" 
		data-isvideo="<?cs var:qz_votebox_isvideo?>">
		<div class="qz_vote_inner<?cs if:!qz_votebox_mainpic?> qz_vote_inner_wide<?cs /if?><?cs if:qz_votebox_isvideo?> icon_video_thumb<?cs /if?>">
			<?cs if:qz_votebox_mainpic?>
			<div class="vote_img">
				<?cs call:ugc_url_check(voteBox.mainpic.jumpurl,0) ?>
				<a href="<?cs alt:ugc_url_check.ret?>javascript:;<?cs /alt?>" <?cs if:ugc_url_check.ret ?>target="_blank" onclick="QZFL.event.cancelBubble(event);"<?cs /if?>>
					<img src="<?cs call:htmlEncodeVar(voteBox.mainpic.url,2,0) ?>"
						 alt="vote image"
						 <?cs #data-role 命名不好，其实应该叫qz-vote-leftbtn?>
						 data-role="qz-vote-videobtn" />
					<?cs if:qz_votebox_isvideo?>
						<i class="ui_icon icon_qz_vote_video" data-role="qz-vote-videobtn"></i>
					<?cs /if?>
				</a>
			</div>
			<?cs /if?><?cs #vote_img?>
			<div class="vote_main vote_main_fold">
				<ul class="vote_list">
					<?cs set:vote_show_count = 6 ?>
					<?cs set:vote_item_count = subcount(qz_metadata.vote_box.options)?>
					<?cs if:vote_item_count < vote_show_count ?>
					<?cs set:vote_show_count = vote_item_count?>
					<?cs /if?>
					<?cs loop:i = 0, vote_show_count - 1, 1 ?>
						<li class="vote_item bg2 bg3_hover">
							<label class="vote_label"><i class="ui_icon icon_qz_vote_checked"></i><input type="<?cs if:voteBox.limit == 1?>radio<?cs else ?>checkbox<?cs /if?>" />
							<?cs var:qz_metadata.vote_box.options[i] ?>
							</label>
						</li>
					<?cs /loop ?>
				</ul>
				<?cs if:qz_metadata.vote_box.num > vote_show_count?>
				<div class="vote_btnbar bg2"><a href="javascript:;" class="ui_mr10">展开更多<?cs var:qz_metadata.vote_box.num - vote_show_count?>项↓</a></div>
				<?cs /if?>
			</div>
		</div>
	</div>
</qz:plugin>
<?cs /with ?>
<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{coupon.cs}?>
<?cs #-------------------- ?>

<?cs #:优惠券组件  ?>
<?cs def:coupon(mod) ?>
<?cs if:qz_metadata.content_box.content.con.type=="coupon_box" ?>
<?cs with:coupon = qz_metadata.content_box.content.con ?>
<?cs #:这里为什么要做html_decode？？ 因为后台多做了一次encode！  ?>
<qz:plugin name="Coupon" config="url=<?cs escape:'url'?><?cs var:html_decode(coupon.url,1) ?><?cs /escape?>">
	<div class="f_ct_imgtxt" style="cursor:pointer">
		<div class="img_box"><a href="javascript:;"><img src="<?cs var:coupon.pic ?>" alt=""></a></div>
		<div class="txt_box">
			<p><?cs var:coupon.content ?></p>
			<p><a href="javascript:;" title="点击领取">点击领取</a></p>
		</div>
	</div>
</qz:plugin>
<?cs /with ?>
<?cs /if ?>
<?cs /def ?>

<?cs #-------------------- ?>
<?cs #{tieban.cs}?>
<?cs #-------------------- ?>

<?cs #:贴板组件  ?>
<?cs def:tieban(mod) ?>
<?cs if:qz_metadata.content_box.content.con.type=="tieban" ?>
<?cs with:tieban = qz_metadata.content_box.content.con ?>
<?cs #:这里为什么要做html_decode？？ 因为后台多做了一次encode！  ?>
<qz:plugin name="Tieban" config="url=<?cs escape:'url'?><?cs var:html_decode(tieban.url,1) ?><?cs /escape?>&tb_id=<?cs var:html_decode(tieban.tb_id,1) ?>">
	<div class="f_ct_imgtxt" style="cursor:pointer">
		<div class="img_box"><a href="javascript:;"><img src="<?cs var:tieban.pic ?>" alt=""></a></div>
		<div class="txt_box">
			<p><?cs var:tieban.content ?></p>
			<p><a href="javascript:;"><?cs var:tieban.button ?></a></p>
		</div>
	</div>
</qz:plugin>
<?cs /with ?>
<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{clock_viewer.cs}?>
<?cs #-------------------- ?>

<?cs #:闹钟提醒feeds组件  ?>
<?cs def:clockBoxViewer() ?>


<?cs def:clockbox_UserList(users, maxcount)?>
	<?cs if:subcount(users.0)?>
		<?cs loop:i=0, maxcount, 1?>
			<?cs var:users[i].uin ?>|
		<?cs /loop?>
	<?cs else ?>
		<?cs var:users.uin ?>
	<?cs /if?>
<?cs /def ?>

<?cs if:subcount(qz_metadata.clock_box) > 0 ?>
<?cs with:clockBox = qz_metadata.clock_box ?>
<div class="f_ct_imgtxt f_ct_act">
	<div class="txt_box">
		<?cs if:clockBox.time ?>
		<p>
			<i class="ui_ico icon_act icon_act_time"></i>
			<?cs var:clockBox.time?>
		</p>
		<?cs /if?>

		<?cs if:subcount(clockBox.lbs) > 0 && clockBox.lbs.name?>
		<p>
			<i class="ui_ico icon_act icon_act_location"></i>
			<?cs var:clockBox.lbs.name ?>
		</p>
		<?cs /if ?>

		<?cs if:clockBox.uincount > 0 ?>
		<?cs set:_clockbox_uincout_max = 24?>
		<?cs if:clockBox.uincount < _clockbox_uincout_max?>
			<?cs set:_clockbox_uincout_max = clockBox.uincount?>
		<?cs /if?>
		<p data-uinlist="<?cs call:clockbox_UserList(clockBox.uinlist.friends, _clockbox_uincout_max) ?>" data-display="hide">
			<a href="javascript:;" class="qz-clock-uinsBtn">
			<i class="ui_ico icon_act icon_act_member"></i>
			<?cs var:clockBox.uincount ?>人参加
			</a>
		</p>
		<?cs /if?>

	</div>
</div>
<?cs /with ?>
<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{music.cs}?>
<?cs #-------------------- ?>

<?cs #:music组件  ?>
<?cs def:music(mod) ?>
<?cs if:subcount(qz_metadata.music_box) > 0 ?>
	<?cs if:qz_metadata.music_box.count>0 ?>
		<?cs set:row2="共"+qz_metadata.music_box.count+"首" ?>
	<?cs else ?>
		<?cs set:row2=qz_metadata.music_box.singer ?>
	<?cs /if ?>
	<div class="f_ct_song controls_<?cs var:qz_metadata.music_box.itemid ?>">
		<?cs set:song_img=qz_metadata.music_box.src_org?>
		<?cs if:string.length(song_img)<1?>
			<?cs set:song_img="http://music.qq.com/musicbox/img/uccpic_error.jpg"?>
		<?cs /if?>

		<?cs if:qz_metadata.music_box.url ?>
			<a href="<?cs call:ugc_url_check(qz_metadata.music_box.url,1) ?>" target=_blank>
				<img class="song_img" src="<?cs call:htmlEncodeVar(song_img,2,0) ?>">
			</a>
			<div class="song_info c_tx">
				<p class="song_name">
					<a href="<?cs call:ugc_url_check(qz_metadata.music_box.url,1) ?>" target=_blank><?cs var:qz_metadata.music_box.title ?></a>
				</p>
			</div>
		<?cs else ?>
			<img class="song_img" src="<?cs call:htmlEncodeVar(song_img,2,0) ?>" alt="">
			<div class="song_info c_tx">
				<p class="song_name"><?cs var:qz_metadata.music_box.title ?></p>
			</div>
		<?cs /if ?>

		<div class="f_ct_music">
			<a 
				data-cmd="qz_popup" 
				href="javascript:void(0)" 
				data-param="<?cs var:qz_metadata.music_box.param ?>" 
				data-version="4" 
				data-src="/music/qzone/music_ic.js" 
				data-needContainer="1" 
				data-charset="utf-8" 
				data-width="375" 
				data-height="169" 
				data-type="Music">
					<span class="music_playbt bor2">
						<span class="music_playbt_i bor2"><b class="trig c_tx"></b><i class="c_tx">播放</i></span>
					</span>
			</a>
		</div>
		<i class="ui_icon icon_music_sign"></i>
	</div>
	<div class="f_ct_song_player player_<?cs var:qz_metadata.music_box.itemid ?>" style="display:none;">
		<a 
			data-cmd="qz_popup"  
			href="javascript:void(0)" 
			data-param="{action:4<?cs var:string.slice(qz_metadata.music_box.param,9, string.length(qz_metadata.music_box.param)) ?>"  
			data-src="/music/qzone/music_ic.js" 
			data-needContainer="1" 
			data-version="4" 
			data-charset="utf-8" 
			data-width="375" 
			data-height="169" 
			data-type="Music">收起</a>
		<div class="flash_<?cs var:qz_metadata.music_box.itemid ?>"></div>
	</div>
<?cs /if?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{game.cs}?>
<?cs #-------------------- ?>

<?cs #:game组件  ?>
<?cs def:game() ?>
<div class="f_ct f_ct_game">
	<div class="f_ct_imgtxt controls_<?cs var:qz_metadata.content_box.media.media.itemid ?>">
		<div class="img_box img_game" >
			<a 
				data-cmd="qz_popup" 
				href="javascript:void(0);" 
				data-version="<?cs var:qz_metadata.content_box.media.media.qz_popup.version ?>" 
				data-width="<?cs var:qz_metadata.content_box.media.media.qz_popup.width ?>" 
				data-height="<?cs var:qz_metadata.content_box.media.media.qz_popup.height ?>" 
				title="点击试玩" 
				data-src="<?cs var:qz_metadata.content_box.media.media.qz_popup.src ?>" 
				data-config="<?cs var:qz_metadata.content_box.media.media.qz_popup.config ?>" 
				class="img_gif"  
				data-type="GamingFeed"
				data-env="<?cs var:qz_metadata.content_box.media.media.qz_popup.env ?>" 
				data-param="<?cs var:qz_metadata.content_box.media.media.qz_popup.param ?>"
			>
				<img src="/ac/b.gif" onload="QZFL.media.adjustImageSize(120,120,
					restXHTML('<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src,2,0) ?>'));" />
				<i class="ui_icon icon_game_play"></i>
			</a>
		</div>
		<div class="txt_box">
			<h4 class="txt_box_title"><?cs var:qz_metadata.content_box.content.con.text ?></h4>
			<p><?cs var:qz_metadata.content_box.content.con.text2 ?></p>
		</div>
	</div>
	<div class="player_<?cs var:qz_metadata.content_box.media.media.itemid ?>" style="display:none;">
		<div class="video_unfold bor3" style="width: 400px; height: 350px; ">
			<div class="flash_<?cs var:qz_metadata.content_box.media.media.itemid ?>"></div>
			<a 
				class="video_retract_bt bor3 bg2 c_tx" 
				data-cmd="qz_popup" 
				style="float:right" 
				title="收起" 
				href="javascript:void(0);" 
				data-param="{action:4<?cs var:string.slice(qz_metadata.content_box.media.media.qz_popup.param,9, string.length(qz_metadata.content_box.media.media.qz_popup.param)) ?>"  
				data-src="<?cs var:qz_metadata.content_box.media.media.qz_popup.src ?>" 
				data-needContainer="1" 
				data-version="4" 
				data-charset="utf-8" 
				data-width="375" 
				data-height="169" 
				data-type="GamingFeed">↑
			</a>
		</div>
		<p class="video_info"><?cs var:qz_metadata.content_box.content.con.text ?></p>
	</div>
</div>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{profile_viewer.cs}?>
<?cs #-------------------- ?>

<?cs #:个人档  ?>
<?cs def:profileViewer(mod) ?>
	<?cs def:showProfileItem(item)?>
	<p>
		<?cs if:item.type == 1 ?>
			<i class="ui_ico icon_profile icon_profile_1"></i>
			<?cs if:string.length(item.firstdata) == 0 ?>
				<?cs var:item.enddata ?>
			<?cs else ?>
				从“<?cs var:item.firstdata ?>”变成“<?cs var:item.enddata ?>”
			<?cs /if ?>
		<?cs elif:item.type == 2?>
			<i class="ui_ico icon_profile icon_profile_2"></i>
			<?cs if:string.length(item.firstdata) == 0 ?>
				搬到“<?cs var:item.enddata ?>”
			<?cs else ?>
				从“<?cs var:item.firstdata ?>”搬到“<?cs var:item.enddata ?>”
			<?cs /if ?>
		<?cs elif:item.type == 3 ?>
			<i class="ui_ico icon_profile icon_profile_3"></i>
			家乡是“<?cs var:item.enddata ?>”
		<?cs /if ?>
	</p>
	<?cs /def ?>

	<?cs if:subcount(qz_metadata.profile) > 0 && qz_metadata.profile.content.type < 4 ?>
	<div class="f_ct_imgtxt f_ct_profile"><div class="txt_box">
		<?cs if: subcount(qz_metadata.profile.psv) > 0 ?>
		<p>
			<a class="c_tx" href="http://user.qzone.qq.com/<?cs var:qz_metadata.profile.psv.host_uin?>/profile/" target="_blank"><?cs var:qz_metadata.profile.psv.host_name?> </a>
			<span class="c_tx3 ">更新了 </span>
			<a class="c_tx" href="http://user.qzone.qq.com/<?cs var:qz_metadata.profile.psv.host_uin?>/profile/" target="_blank">个人资料</a>
		</p>
		<?cs /if ?>

		<?cs if: subcount(qz_metadata.profile.content.0) > 0 ?>
		<?cs each:item=qz_metadata.profile.content ?>
			<?cs call:showProfileItem(item) ?>
		<?cs /each ?>
		<?cs else ?>
			<?cs call:showProfileItem(qz_metadata.profile.content) ?>
		<?cs /if ?>
	</div></div>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{magicemotion.cs}?>
<?cs #-------------------- ?>

<?cs #qz_metadata.magicemotion ?>
<?cs def:attachmentMagicemotionPresenter() ?>
<?cs if: subcount(qz_metadata.magicemotion) > 0?>
<qz:plugin name="attachmentPresenter" config='<?cs var:qz_metadata.magicemotion.config ?>'>
<a href="javascript:;">
	<img src="/ac/b.gif" onload="QZFL.media.adjustImageSize(120,120,
								'http://qzonestyle.gtimg.cn/qzone/em/120/mb<?cs var:qz_metadata.magicemotion.id ?>.jpg');"/>
</a>
</qz:plugin>
<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{location_info.cs}?>
<?cs #-------------------- ?>

<?cs def:locationInfo(mod) ?>
<?cs if:subcount(qz_metadata.lbs) > 0 ?>
	<p class="f_reprint c_tx3">
		<?cs if:qz_metadata.lbs.idname ?>
			<span class='ui_mr10'><?cs var:qz_metadata.lbs.idname ?></span>
		<?cs else if:qz_metadata.lbs.name ?>
			<span class='ui_mr10'><?cs var:qz_metadata.lbs.name ?></span>
		<?cs /if ?>
		<?cs #:等于900的地理位置信息不显示，原因是无法定位到具体地点就统一给900 ?>
		
			<?cs if: qz_metadata.lbs.posx && qz_metadata.lbs.posy && qz_metadata.lbs.posx!=900 && qz_metadata.lbs.posy!=900 ?>
				<a 
					data-cmd="qz_popup" 
					href="javascript:void(0)" 
					data-version="<?cs alt:qz_metadata.lbs.showmap.qz_popup.version ?>5<?cs /alt ?>" 
					data-width="300" 
					data-height="200" 
					data-title="<?cs var:qz_metadata.lbs.showmap.qz_popup.title ?>" 
					data-src="/qzone/app/controls/map/tips.html" 
					data-config="<?cs alt:qz_metadata.lbs.showmap.qz_popup.config ?>id:map<?cs /alt ?>" 
					class="c_tx ui_mr10" 
					data-param="#posx=<?cs var:qz_metadata.lbs.posx ?>&posy=<?cs var:qz_metadata.lbs.posy ?>" 
				>查看地图</a>
			<?cs elif:subcount(qz_metadata.lbs.showmap.qz_popup) > 0 && qz_metadata.lbs.posx!=900 && qz_metadata.lbs.posy!=900 ?>
				<?cs # 也要给老数据一个兼容 ，poiid是现在才加的，如果没有这个的话有可能是老数据?>
				<a 
					data-cmd="qz_popup" 
					href="javascript:void(0)" 
					data-version="<?cs alt:qz_metadata.lbs.showmap.qz_popup.version ?>5<?cs /alt ?>" 
					data-width="300" 
					data-height="200" 
					data-title="<?cs var:qz_metadata.lbs.showmap.qz_popup.title ?>" 
					data-src="<?cs var:qz_metadata.lbs.showmap.qz_popup.src ?>" 
					data-config="<?cs alt:qz_metadata.lbs.showmap.qz_popup.config ?>id:map<?cs /alt ?>" 
					class="c_tx ui_mr10" 
					data-param="<?cs var:qz_metadata.lbs.showmap.qz_popup.param ?>" 
				>查看地图</a>
			<?cs /if ?>
	</p>
<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{attach_info.cs}?>
<?cs #-------------------- ?>

<?cs #:附件详情 ?>
<?cs def:attachInfo(mod) ?>
	<?cs set:qz_attachinfo_count = qz_metadata.content_box.attachnum ?>
	<?cs set:qz_attachinfo_node = qz_metadata.content_box.attachtype ?>
	<?cs set:qz_attachinfo_arr = 0 ?>
	<?cs set:qz_attachinfo_index = 0 ?>
	<?cs if:qz_attachinfo_count > 1 ?>

	<?cs #:qz_attachinfo_node 二进制用作字符串，需要补足位数 ?>
	<?cs def:fillAttachinfoNode() ?>
		<?cs if:string.length(qz_attachinfo_node) < 7 ?>
			<?cs set:qz_attachinfo_node = "0"+qz_attachinfo_node ?>
			<?cs call:fillAttachinfoNode() ?>
		<?cs /if ?>
	<?cs /def ?>
	<?cs call:fillAttachinfoNode() ?>

	<?cs #:动画 附件 投票 视频 网页 图片 ?>
		<?cs if:qz_metadata.content_box.attachurl ?>
			<a href="<?cs call:ugc_url_check(qz_metadata.content_box.attachurl,1) ?>" class="c_tx" target="_blank">
		<?cs else ?>
			<a href="http://user.qzone.qq.com/<?cs var:qz_metadata.metadata.uin ?>/mood/<?cs var:qz_metadata.metadata.blogid ?>.1" class="c_tx" target="_blank">
		<?cs /if ?>
		<span class="ui_mr10">内含
		<?cs if:string.slice(qz_attachinfo_node,4,5) == 1 ?>
			<?cs set:qz_attachinfo_arr[qz_attachinfo_index] = '视频' ?>
			<?cs set:qz_attachinfo_index = qz_attachinfo_index + 1 ?>
		<?cs /if ?>
		<?cs if:string.slice(qz_attachinfo_node,6,7) == 1 ?>
			<?cs set:qz_attachinfo_arr[qz_attachinfo_index] = '图片' ?>
			<?cs set:qz_attachinfo_index = qz_attachinfo_index + 1 ?>
		<?cs /if ?>
		<?cs if:string.slice(qz_attachinfo_node,0,1) == 1 ?>
			<?cs set:qz_attachinfo_arr[qz_attachinfo_index] = '音乐' ?>
			<?cs set:qz_attachinfo_index = qz_attachinfo_index + 1 ?>
		<?cs /if ?>
		<?cs if:string.slice(qz_attachinfo_node,1,2) == 1 ?>
			<?cs set:qz_attachinfo_arr[qz_attachinfo_index] = '动画' ?>
			<?cs set:qz_attachinfo_index = qz_attachinfo_index + 1 ?>
		<?cs /if ?>
		<?cs if:string.slice(qz_attachinfo_node,2,3) == 1 ?>
			<?cs set:qz_attachinfo_arr[qz_attachinfo_index] = '附件' ?>
			<?cs set:qz_attachinfo_index = qz_attachinfo_index + 1 ?>
		<?cs /if ?>
		<?cs loop:i = 0, subcount(qz_attachinfo_arr) - 1, 1 ?>
			<?cs if:i == 0 ?>
			<?cs elif:i == subcount(qz_attachinfo_arr) - 1?>
				和
			<?cs else ?>、
			<?cs /if ?>
			<?cs var:qz_attachinfo_arr[i] ?>
		<?cs /loop ?>
		 查看详情</span>
	</a>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{timeline.cs}?>
<?cs #-------------------- ?>

<?cs #:timeline组件  ?>
<?cs def:timeline(mod) ?>
<?cs if:subcount(qz_metadata.timeline) > 0 ?>
<?cs with:timeline = qz_metadata.timeline ?>
<p class="f_reprint c_tx3">
	<?cs if:timeline.time.text ?>于<span class="c_tx3 ui_mr5"><?cs var:timeline.time.text ?></span><?cs /if ?><?cs if:timeline.place ?><span class="c_tx3 ui_mr5" title="<?cs var:timeline.orgplace ?>">在<?cs var:timeline.place ?></span><?cs /if ?>
	<?cs def:person-items(item) ?>
		<?cs call:userLink(item, '') ?>
	<?cs /def ?>
	<?cs if:timeline.person.user.0 || subcount(timeline.person.user.0) > 0 || string.length(timeline.person.user.0) > 0 ?>
		和<?cs loop:i = 0, subcount(timeline.person.user) - 1, 1 ?>
			<?cs call:person-items(timeline.person.user[i]) ?>
			<?cs if:i != subcount(timeline.person.user) - 1 ?>、<?cs /if ?>
		<?cs /loop ?><?cs if:timeline.person.totalperson > 2 ?>等<?cs var:timeline.person.totalperson ?>人<?cs /if ?>
	<?cs elif:timeline.person.user || subcount(timeline.person.user) > 0 || string.length(timeline.person.user) > 0 ?>
			和<?cs call:person-items(timeline.person.user) ?>
	<?cs /if ?>
</p>
<?cs /with ?>
<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{markPhotoInfo.cs}?>
<?cs #-------------------- ?>

<?cs def:markPhotoInfo(mod) ?>
	<?cs def:markPhotoCnt(info)?>
		<p>相册名称：<a target="_blank" href="<?cs call:ugc_url_check(info.album.url,1) ?>"><?cs var:info.album.name ?></a></p>
		<p><?cs var:info.describe ?></p>
		<p><a target="_blank" href="http://user.qzone.qq.com/<?cs var:info.markuser.uin ?>/photo/marked" ?>查看<?cs var:info.markcount?>张圈有<?cs var:info.markuser.name?>的照片</a></p>
	<?cs /def ?>
	<?cs if:subcount(qz_metadata.content_box.markphoto_info) > 0 ?>
	<div class="txt_box">
		<?cs call:markPhotoCnt(qz_metadata.content_box.markphoto_info) ?>
	</div>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{extend_info.cs}?>
<?cs #-------------------- ?>

<?cs #:
	param.data展示数据
	param.key业务的key
	param.max_count展示列表的最多用户数
	param.totalNum 总数
	param.endword结束文案
	param.isNeedMe是否显示“我”
	param.showmode:为1时，isNeedMe为真或者有列表数据为真的时候再展示;为2时，只要totalNum大于1就展示
	param.needShowlist:是否需要详细的列表入口
 ?>
<?cs #:data,key,max_count,totalNum,endword,isNeedMe,showmode,needShowlist ?>
<?cs def:genUserList(data,param) ?>
	<?cs if: subcount(data.0) ?>
		<?cs set:_data_len=subcount(data) ?>
	<?cs elif:subcount(data)>0 ?>
		<?cs set:_data_len=1 ?>
	<?cs else ?>
		<?cs set:_data_len=0 ?>
	<?cs /if ?>
	<?cs if: _data_len>param.max_count ?>
		<?cs set:_data_len=param.max_count ?>
	<?cs /if ?>
	<?cs if: param.isNeedMe ?>
		<span class="_me">		
			我
		<?cs if: param.totalNum>1 ?>
			和
		<?cs /if ?>
		</span>
	<?cs /if ?>
	<?cs loop:i=0,_data_len-1,1 ?>
		<?cs if: subcount(data[i]) ?>
			<?cs call:userLink(data[i],'') ?>
			<?cs if: i<(_data_len-1) ?>、<?cs /if ?>
		<?cs else ?>
			<?cs call:userLink(data,'') ?>
		<?cs /if ?>
	<?cs /loop ?>
	<?cs #:产品说数字先别放出来 ?>
	<?cs if: 0 && _data_len==0 && param.isNeedMe ?>	
		<?cs set:_rander_pre=param.totalNum+"人" ?>
		<?cs set:_rander_tail="" ?>
	<?cs elif:0 && _data_len<param.totalNum  ?>
		<?cs set:_rander_pre="等" ?>	
		<?cs set:_rander_pre=_rander_pre+param.totalNum+"人" ?>
		<?cs set:_rander_tail="都" ?>
	<?cs /if ?>
	<span class="_listcnt <?cs if:_data_len>0 ?>ui_ml5<?cs /if ?>">
		<?cs if: param.needShowlist ?>
			<?cs set:_node_Name="a" ?>
			<?cs set:_nodeParam='href="javascript:;" class="c_tx _showList" data-key="' ?>
			<?cs set:_nodeParam=_nodeParam+param.key+'"' ?>
		<?cs else ?>
			<?cs set:_node_Name="span" ?>
			<?cs set:_nodeParam="" ?>
		<?cs /if ?>
		<<?cs var:_node_Name ?> <?cs var:_nodeParam ?> >
			<?cs var:_rander_pre ?>
		</<?cs var:_node_Name ?>>
		<?cs var:_rander_tail ?>
	</span>
	<?cs var:param.endword ?>
<?cs /def ?>
<?cs #:附加信息区域 ?>
<?cs def:extendInfo(mod) ?>
	<?cs set:qz_extendinfo_name = 'extend_info' ?>
	<?cs if:subcount(qz_metadata.extend_info_2) > 0 ?>
		<?cs set:qz_extendinfo_name = 'extend_info_2' ?>
	<?cs /if ?>
	<?cs def:extendInfo-items(item) ?>
		<?cs if:item.type == 'source' ?>
			<?cs #:内容区的来源不需要了 ?>
		<?cs elif:item.type == 'picnum' ?>
			<?cs if:item.count > 0?>
			<span class='ui_mr10'>共有<?cs var:item.count ?>张图片</span>
			<?cs /if?>
		<?cs #:这里为统一计数迁移到天津做个兼容过渡 ?>
		<?cs if: qz_metadata.qz_data.version!=1 ?>
			<?cs set:mydef_qz_orgin_cnt=" none" ?>
		<?cs /if ?>
		<?cs elif:item.type == 'forward' && (qz_metadata.qz_data.version!=1 || qz_metadata.qz_data.key2.ZZ.cnt>0) ?>
			<?cs #:转载原先使用的是item.count,这里尝试使用统一计数的数据试试 ?>
			<span class='ui_mr10 qz_orgin_cnt<?cs var:mydef_qz_orgin_cnt ?>' cnttype='forward'>转载(<?cs var:qz_metadata.qz_data.key2.ZZ.cnt ?>)</span>
		<?cs elif:item.type == 'share' && (qz_metadata.qz_data.version!=1 || (qz_metadata.qz_data.key2.ZF.cnt-0+qz_metadata.qz_data.key2.WB.cnt)>0) ?>
			<span class='ui_mr10 qz_orgin_cnt<?cs var:mydef_qz_orgin_cnt ?>' cnttype='share'>原文被转(<?cs var:qz_metadata.qz_data.key2.ZF.cnt-0+qz_metadata.qz_data.key2.WB.cnt ?>)次</span>
		<?cs elif:item.type == 'retweet' && (qz_metadata.qz_data.version!=1 || qz_metadata.qz_data.key2.ZS.cnt>0) ?>
			<?cs #:来源空间的原文链接 ?>
			<?cs if:!retweet_url ?>
				<?cs set:retweet_url = "http://user.qzone.qq.com/"+qz_metadata.metadata.orguin+"/mood/"+qz_metadata.metadata.orgid+"."+qz_metadata.metadata.orgpfid ?>
			<?cs /if ?>
			<span class='ui_mr10 qz_orgin_cnt<?cs var:mydef_qz_orgin_cnt ?>' cnttype='retweet'>
				<a target=_blank class="c_tx3" href="<?cs call:ugc_url_check(retweet_url,1) ?>#action=forward">转发(<?cs var:qz_metadata.qz_data.key2.ZS.cnt ?>)</a>
			</span>
			<span class='ui_mr10'>
				<a target=_blank class="c_tx3" href="<?cs call:ugc_url_check(retweet_url,1) ?>">评论<?cs if:qz_metadata.qz_data.key2.CS.cnt>0 ?>(<?cs var:qz_metadata.qz_data.key2.CS.cnt ?>)<?cs /if ?></a>
			</span>
		<?cs elif:item.type == 'gift_sendnum' ?>
			<span class='ui_mr10'>该礼物已被赠送<?cs var:item.count ?>次</span>
		<?cs elif:item.type == 'gift_birthnum' ?>
			<span class='ui_mr10'>共收到<?cs var:item.count ?>份生日礼物</span>
		<?cs elif:item.type == 'orgintime' ?>
			<span class='ui_mr10'><?cs var:item.text ?></span>
		<?cs elif:item.type == 'care' ?>
			<span class="ui_mr10">共有<?cs var:item.count ?>人关注</span>
		<?cs elif:item.type == 'txt' ?>
			<span><?cs var:item.text ?></span>
		<?cs elif:item.type == 'url' ?>
			<a href="<?cs call:ugc_url_check(item.url,1) ?>" target="_blank"><?cs var:item.text ?></a>
		<?cs elif:item.type == 'uin' ?>
			<?cs call:userLink(item , '') ?>
		<?cs /if ?>

	<?cs /def ?>
	<?cs with:exinfo = qz_metadata[qz_extendinfo_name] ?>
	<?cs if:exinfo.info.0 || subcount(exinfo.info.0) > 0 ?>
		<p class="f_reprint c_tx3 _extendInfo_">
		<?cs loop:i = 0, subcount(exinfo.info) -1, 1 ?>
			<?cs call:extendInfo-items(exinfo.info[i]) ?>
		<?cs /loop ?>
		</p>
	<?cs elif:exinfo.info.type ?>
		<p class="f_reprint c_tx3 _extendInfo_">
		<?cs call:extendInfo-items(exinfo.info) ?>
		</p>
	<?cs elif:subcount(exinfo.cate) > 0 ?>
		<div class="f_votestar">
			<span class="votestar">
				<span class="votestar_i star_<?cs var:exinfo.cate.grade?>"></span>
			</span>
			<span class="votescore">
				<?cs if:exinfo.cate.taste ?><span class="ui_mr10 c_tx3">口味：<?cs var:exinfo.cate.taste ?></span><?cs /if ?>
				<?cs if:exinfo.cate.svc ?><span class="ui_mr10 c_tx3">服务：<?cs var:exinfo.cate.svc ?></span><?cs /if ?>
				<?cs if:exinfo.cate.env ?><span class="ui_mr10 c_tx3">环境：<?cs var:exinfo.cate.env ?></span><?cs /if ?>
				<?cs if:exinfo.cate.consume ?><span class="ui_mr10 c_tx3">人均：<?cs var:exinfo.cate.consume ?>元</span><?cs /if ?>
			</span>
		</div>
	<?cs elif:subcount(exinfo.qz_app) > 0 ?>
		<?cs def:extInfo-app(item) ?>
			<a class="c_tx" target="_blank" href="
			<?cs alt:item.url?>http://rc.qzone.qq.com/myhome/<?cs var:item.id?><?cs /alt?>
			"><?cs var:item.name ?></a>
		<?cs /def ?>

		<?cs with:app = exinfo.qz_app.app ?>
		<?cs if:subcount(app) > 0?>
		<p class="f_reprint c_tx3">
			<?cs with:user = exinfo.qz_app.user?>
			<a href="http://user.qzone.qq.com/<?cs var:user.uin ?>" class="q_namecard c_tx" link="nameCard_<?cs var:user.uin ?>" target="_blank"><?cs call:writeUserName(user.uin,user.nickname) ?></a>
			<?cs /with ?>还添加了
			<?cs if:app.0 || subcount(app.0) >0 ?>
				<?cs set:ex_appshow_count = subcount(app) ?>
				<?cs loop:i = 0, ex_appshow_count - 1, 1?>
					<?cs call:extInfo-app(app[i])?>
					<?cs if:i < ex_appshow_count - 2 ?>、<?cs /if ?>
					<?cs if:i == ex_appshow_count - 2 ?>和<?cs /if?>
				<?cs /loop ?>
				<?cs if: exinfo.qz_app.count >= ex_appshow_count ?>
					<?cs if:ex_appshow_count < exinfo.qz_app.count?>等<?cs /if?><?cs var:exinfo.qz_app.count?>款应用
				<?cs /if ?>
			<?cs else ?>
				<?cs call:extInfo-app(app)?>
			<?cs /if ?>
		</p>
		<?cs /if ?>
		<?cs /with ?>
	<?cs elif:subcount(exinfo.sameusers.user) > 0 && exinfo.sameusers.type ?>
		<?cs if:exinfo.sameusers.type == "app"?>
			<p class="f_reprint c_tx3">
			<?cs if:subcount(exinfo.sameusers.user.0) > 0?>
				<?cs set:ex_show_count = subcount(exinfo.sameusers.user)?>
				<?cs with:user=exinfo.sameusers.user?>
				<?cs loop:i = 0, ex_show_count - 1, 1?>
					<a href="http://user.qzone.qq.com/<?cs var:user[i].uin ?>" class="q_namecard c_tx" link="nameCard_<?cs var:user[i].uin ?>" target="_blank"><?cs call:writeUserName(user[i].uin, user[i].nickname) ?></a>
					<?cs if:i < ex_show_count - 2 ?>、<?cs /if ?>
					<?cs if:i == ex_show_count - 2 ?>和<?cs /if?>
				<?cs /loop ?>
				<?cs if: exinfo.sameusers.count > ex_show_count?>等<?cs var:exinfo.sameusers.count ?>个好友<?cs /if?>
				<?cs /with?>
			<?cs else ?>
				<a href="http://user.qzone.qq.com/<?cs var:exinfo.sameusers.user.uin ?>" class="q_namecard c_tx" link="nameCard_<?cs var:exinfo.sameusers.user.uin ?>" target="_blank"><?cs call:writeUserName(exinfo.sameusers.user.uin, exinfo.sameusers.user.nickname) ?></a>
			<?cs /if?>也向我发了请求
			</p>
		<?cs /if ?>
	<?cs /if ?>
	<?cs /with ?>

	<?cs #动态合并附加信息?>
	<?cs def:showDynamic(mod) ?>
		<?cs if:mod.name == "extendInfo" && mod.dynamic == "on" && subcount(qz_metadata.relyPool)>0 ?>
			<?cs set:_param.max_count=mod.dynamic.max_count ?>
			<?cs set:_param.endword=mod.dynamic.endword ?>
			<?cs if: mod.dynamic.isNeedMe ?>
				<?cs set:_param.endword=qz_metadata.relyPool.hasMe ?>
			<?cs /if ?>
			<?cs set:_param.showmode=mod.dynamic.showmode ?>
			<?cs set:_param.needShowlist=mod.dynamic.needShowlist ?>
			<?cs if: qz_metadata.metadata.appid==202 ?>
				<?cs #:跟原文分享数量一样 ?>
				<?cs set:_param.totalNum=qz_metadata.qz_data.key2.ZF.cnt-0+qz_metadata.qz_data.key2.WB.cnt ?>
			<?cs elif:qz_metadata.metadata.appid==311 ?>
				<?cs #:跟原文转发数量一样 ?>
				<?cs set:_param.totalNum=qz_metadata.qz_data.key2.ZS.cnt ?>
			<?cs /if ?>
			<p class="f_reprint c_tx3">
				<span class="ur_mr10">
						<?cs call:genUserList(qz_metadata.relyPool,_param) ?>
				</span>
			</p>
		<?cs /if ?>	
	<?cs /def ?>
	<?cs #:这里没办法了，粗暴的查找下节点，找时间优化掉 ?>
	<?cs if: subcount(mod.mod.0) ?>
		<?cs loop:i=0,subcount(mod.mod)-1,1 ?>
			<?cs if: mod.mod[i].name == "extendInfo" ?>
				<?cs call:showDynamic(mod.mod[i]) ?>
			<?cs /if ?>
		<?cs /loop ?>
	<?cs elif:(subcount(mod.mod)||string.length(mod.mod.name))&& mod.mod.name == "extendInfo"?>
		<?cs call:showDynamic(mod.mod) ?>
	<?cs /if ?>
<?cs /def ?>

<?cs def:sameUserList(max_num)?>
	<?cs with:exinfo=qz_metadata.extend_info?>
	<?cs if:subcount(exinfo.sameusers.user) > 0 && !exinfo.sameusers.type ?><?cs #没有type默认是七周年的feeds?>
	<div class="f_ct_act_ava">
		<p><?cs alt:exinfo.sameusers.title.text?>他们也参与了活动<?cs /alt?></p>
		<?cs if:subcount(exinfo.sameusers.user.0) > 0 ?>
			<?cs set:qz_users_len=subcount(exinfo.sameusers.user)?>
			<?cs #默认最多展示11个?>
			<?cs set:qz_info_umax=min(min(max_num, 11), qz_users_len)?>
			<?cs loop:i = 1,qz_info_umax, 1 ?>
				<?cs call:userIconStyle(exinfo.sameusers.user[i-1], 'act')?>
			<?cs /loop ?>
			<?cs if:qz_users_len > qz_info_umax?>
				<span class="act_ava_more bor3 bg3 bg2_hover" title="共<?cs var:qz_users_len?>位好友">...</span>
			<?cs /if?>
		<?cs elif:subcount(exinfo.sameusers.user) > 0 ?>
			<?cs call:userIconStyle(exinfo.sameusers.user, 'act')?>
		<?cs /if ?>
	</div>
	<?cs /if ?>
	<?cs /with ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{attach.cs}?>
<?cs #-------------------- ?>

<?cs #:附件 ?>
<?cs def:attachViewer(mod) ?>
	<?cs if:subcount(qz_metadata.attach.attachfile) > 0 ?>
		<div class="feeds_attach_wrap">
			<qz:plugin name="Attach" config="path=<?cs escape:'url'?><?cs var:qz_metadata.attach.attachfile.path?><?cs /escape?>&uin=<?cs escape:'url'?><?cs var:qz_metadata.attach.attachfile.owner?><?cs /escape?>">
				<div class="feeds_attach bor bg3 attachProfile" title="点击查看附件">
					<div class="feeds_attach_icon rbor bg2"></div>
					<div class="feeds_attach_content "><a href="javascript:void(0);" onclick="return false;" class="c_tx attach_name attachName"><?cs var:qz_metadata.attach.attachfile.name?></a></div>
				</div>
			</qz:plugin>
		</div>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{content_box.cs}?>
<?cs #-------------------- ?>

<?cs #:来自组件,用于内容区内 ?>
<?cs def:iconSource(item) ?>
<div class="f_websiteicon">
	<?cs if:item.who ?>
		<span class='c_tx3'>来自</span><?cs call:userLink(item, '') ?>
	<?cs elif:item.url ?>
		<span class='ui_mr10 c_tx3'>来自<a href="<?cs call:ugc_url_check(item.url,1) ?>" target="_blank" class="c_tx"><?cs var:item.name ?></a></span>
	<?cs else ?>
		<span class='ui_mr10 c_tx3'>来自<?cs var:item.name ?></span>
	<?cs /if ?>
</div>
<?cs /def ?>

<?cs #: ===================================================================================================== ?>
<?cs #:
	/**
	 * 图片对象的描述
	 * @object media
	 * @param {Object} media 包含图片信息的object
	 * @param {String} media.mydef_onload 自定义的图片onload事件方法体，如果不设置则用默认的
	 * @param {String} media.mydef_widthLimit 图片展示区域的最大宽度
	 * @param {String} media.mydef_heightLimit 图片展示区域的最大高度
	 * @param {String} media.mydef_imgurl 图片真实的url，用在onload事件中的（有些图片是通过回填给img节点）
	 * @param {String} media.mydef_imgsrc 图片url用来填到img节点的src（填src专用，因为如果使用onload来回填节点的话，mydef_imgurl和mydef_imgsrc可能出现不同）
	 * @param {String} media.newWidth 图片的实际宽度
	 * @param {String} media.newHeight 图片的实际高度
	 */
	media = {};
?>

<?cs #:
	/**
	 * 很简单的方法，输出一个img节点，空出各种信息设置，参数中有的就填上，没有的就算了
	 * 这里不给参数设默认值，使用此方法的人不可以偷懒，希望见到这个方法的时候，我们就能知道img的src是什么
	 * @param  {String} src     图片src 
	 * @param  {[type]} width   设置图片的宽
	 * @param  {[type]} height  设置图片的高
	 * @param  {String} sty     给图片节点设置的style值
	 * @param  {String} cls     给图片节点的class值
	 * @param  {String} onload  图片节点的onload事件方法体
	 * @param  {String} onerror 图片节点的onerror事件方法体
	 * @param  {String} extend  可以给图片加上一些你希望有的信息
	 * @return undefined
	 */
	function m_printImageElement(src,width,height,sty,cls,onload,onerror,extend){}
?>
<?cs def:m_printImageElement(src,width,height,sty,cls,onload,onerror,extend) ?>
	<img src="<?cs call:htmlEncodeVar(src,2,0) ?>" 
	<?cs if:width ?>width="<?cs var:width ?>" <?cs /if ?>
	<?cs if:height ?>height="<?cs var:height ?>" <?cs /if ?>
	<?cs if:sty ?>style="<?cs var:sty ?>" <?cs /if ?>
	<?cs if:cls ?>class="<?cs var:cls ?>" <?cs /if ?>
	<?cs if:onload ?>onload="<?cs var:onload ?>" <?cs /if ?>
	<?cs if:onerror ?>onerror="<?cs var:onerror ?>" <?cs /if ?>
	<?cs if:extend ?><?cs var:extend ?><?cs /if ?> />
<?cs /def ?>


<?cs #: =================================没有高宽信息时的逻辑=============================== ?>

<?cs #:
	/**
	 * 为图片展示打上一些标志
	 * @param  {Number|String} phototype 图片类型的标志
	 * @return undefined
	 */
	function imageFlag(phototype){}
?>
<?cs def:imageFlag(phototype) ?>
	<?cs if:phototype == 2?><i class="ui_ico icon_gif_sign"></i><?cs /if ?>
	<?cs if:phototype == 3?><i class="ui_ico icon_doc_sign"></i><?cs /if ?>
<?cs /def ?>

<?cs #:
	/**
	 * 用js对图片进行短边压缩
	 * @param {Object} media 包含图片信息的object
	 * @param {String} media.mydef_onload 自定义的图片onload事件方法体，如果不设置则用默认的
	 * @param {String} media.mydef_widthLimit 图片展示区域的最大宽度
	 * @param {String} media.mydef_heightLimit 图片展示区域的最大高度
	 * @param {String} media.mydef_imgurl 图片真实的url，用在onload事件中的（有些图片是通过回填给img节点）
	 * @param {String} media.mydef_imgsrc 图片url用来填到img节点的src（填src专用，因为如果使用onload来回填节点的话，mydef_imgurl和mydef_imgsrc可能出现不同）
	 */
	function ReduceImageByShortEdge(media){}
?>
<?cs def:ReduceImageByShortEdge(media) ?>
	<?cs if:string.length(media.mydef_onload) ?>
		<?cs set:ReduceImageByShortEdge_Res.mydef_ShortEdge_onload=media.mydef_onload ?>
	<?cs else ?>
		<?cs set:media.mydef_imgurl=string_firstwords_filter(media.mydef_imgurl,"javascript:") ?>
		<?cs call:htmlEncodeVar(media.mydef_imgurl,2,1) ?>
		<?cs set:ReduceImageByShortEdge_Res.mydef_ShortEdge_onload="QZFL.media.reduceImage(1," + 
								media.mydef_widthLimit + "," +
								media.mydef_heightLimit +
								",{
									trueSrc:restXHTML('" + htmlEncodeVar_Res + "'),
									callback:function(img,type,ew,eh,o){
										var p=img.parentNode,
											_h = Math.floor(o.oh/o.k),
											_w = Math.floor(o.ow/o.k);
										if(_h<=eh){
											p.style.height=_h+'px';
										}else{
											img.style.marginTop=(eh-_h)/2+'px';
										}
										img.style.marginLeft=(ew-_w)/2+'px';
									}
								})" ?>
	<?cs /if ?>
	<?cs if: string.length(media.mydef_imgsrc)>0 ?>
		<?cs set:ReduceImageByShortEdge_Res.mydef_imgsrc=media.mydef_imgsrc ?>
	<?cs else ?>
		<?cs set:ReduceImageByShortEdge_Res.mydef_imgsrc='/ac/b.gif' ?>
	<?cs /if ?>
	<?cs call:imageFlag(media.phototype) ?>
	<?cs call:m_printImageElement(ReduceImageByShortEdge_Res.mydef_imgsrc,'','',"","",ReduceImageByShortEdge_Res.mydef_ShortEdge_onload,"","") ?>
<?cs /def ?>

<?cs #:
	/**
	 * 用js对图片进行长边压缩
	 * @param {Object} media 包含图片信息的object
	 * @param {String} media.mydef_onload 自定义的图片onload事件方法体，如果不设置则用默认的
	 * @param {String} media.mydef_widthLimit 图片展示区域的最大宽度
	 * @param {String} media.mydef_heightLimit 图片展示区域的最大高度
	 * @param {String} media.mydef_imgurl 图片真实的url，用在onload事件中的（有些图片是通过回填给img节点）
	 * @param {String} media.mydef_imgsrc 图片url用来填到img节点的src（填src专用，因为如果使用onload来回填节点的话，mydef_imgurl和mydef_imgsrc可能出现不同）
	 */
	function ReduceImageByLongEdge(media){}
?>
<?cs def:ReduceImageByLongEdge(media) ?>
	<?cs if: string.length(media.mydef_onload) ?>
		<?cs set:ReduceImageByLongEdge_Res.mydef_LongEdge_onload=media.mydef_onload ?>
	<?cs else ?>
		<?cs set:media.mydef_imgurl=string_firstwords_filter(media.mydef_imgurl,"javascript:") ?>
		<?cs call:htmlEncodeVar(media.mydef_imgurl,2,1) ?>
		<?cs set:ReduceImageByLongEdge_Res.mydef_LongEdge_onload="QZFL.media.reduceImage(0," + 
								media.mydef_widthLimit + "," +
								media.mydef_heightLimit +
								",{
									trueSrc:restXHTML('"+htmlEncodeVar_Res+"'),
									callback:function(img,type,ew,eh,o){
										var _h = Math.floor(o.oh/o.k),
											_w = Math.floor(o.ow/o.k);
										if(_w<=ew && _h<=eh){
											var p=img.parentNode;
											p.style.width=_w+'px';
											p.style.height=_h+'px';
										}
									}
								})" ?>
	<?cs /if ?>
	<?cs if: string.length(media.mydef_imgsrc)>0 ?>
		<?cs set:ReduceImageByLongEdge_Res.mydef_imgsrc=media.mydef_imgsrc ?>
	<?cs else ?>
		<?cs set:ReduceImageByLongEdge_Res.mydef_imgsrc='/ac/b.gif' ?>
	<?cs /if ?>
	<?cs call:imageFlag(media.phototype) ?>
	<?cs call:m_printImageElement(ReduceImageByLongEdge_Res.mydef_imgsrc,'','',"","",ReduceImageByLongEdge_Res.mydef_LongEdge_onload,"","") ?>
<?cs /def ?>
<?cs #: =================================没有高宽信息时的逻辑 END=============================== ?>


<?cs #: =================================有高宽信息时的逻辑 ==================================== ?>

<?cs #:
	/**
	 * 计算压缩信息的方法,计算结果存放在getReduceInfo_Res中
	 * getReduceInfo_Res.onload
	 * getReduceInfo_Res.long_pro
	 * getReduceInfo_Res.short_pro
	 * @param  {Obkect} media 包含图片信息的object
	 * @param  {String} media.mydef_widthLimit 图片展示区域的最大宽度
	 * @param  {String} media.mydef_heightLimit 图片展示区域的最大高度
	 * @param  {String} media.newWidth 图片的实际宽度
	 * @param  {String} media.newHeight 图片的实际高度
	 * @return {Object} getReduceInfo_Res
	 */
	function getReduceInfo(media){}
?>
<?cs def:getReduceInfo(media) ?>
	<?cs set:media.mydef_widthLimit=media.mydef_widthLimit-0 ?>
	<?cs set:media.mydef_heightLimit=media.mydef_heightLimit-0 ?>
	<?cs set:media.newWidth=media.newWidth-0 ?>
	<?cs set:media.newHeight=media.newHeight-0 ?>

	<?cs if:media.newWidth>=media.newHeight ?>
		<?cs #:宽为长边 ?>
		<?cs if:media.newWidth>=media.mydef_widthLimit ?>
			<?cs set:getReduceInfo_Res.long_pro = 'width="'+media.mydef_widthLimit+'"' ?>
		<?cs else ?>
			<?cs set:getReduceInfo_Res.long_pro = 'width="'+media.newWidth+'"' ?>
		<?cs /if ?>
		<?cs if:media.newHeight>=media.mydef_heightLimit ?>
			<?cs set:getReduceInfo_Res.short_pro = 'height="'+media.mydef_heightLimit+'"' ?>
		<?cs else ?>
			<?cs set:getReduceInfo_Res.short_pro = 'height="'+media.newHeight+'"' ?>
		<?cs /if ?>
	<?cs else ?>
		<?cs #:高为长边 ?>
		<?cs if:media.newHeight>=media.mydef_heightLimit ?>
			<?cs set:getReduceInfo_Res.long_pro = 'height="'+media.mydef_heightLimit+'"' ?>
		<?cs else ?>
			<?cs set:getReduceInfo_Res.long_pro = 'height="'+media.newHeight+'"' ?>
		<?cs /if ?>
		<?cs if:media.newWidth>=media.mydef_widthLimit ?>
			<?cs set:getReduceInfo_Res.short_pro = 'width="'+media.mydef_widthLimit+'"' ?>
		<?cs else ?>
			<?cs set:getReduceInfo_Res.short_pro = 'width="'+media.newWidth+'"' ?>
		<?cs /if ?>
	<?cs /if ?>
	<?cs set:getReduceInfo_Res.onload = "var p=this.parentNode;
										if(this.width<="+media.mydef_widthLimit+"){
											p.style.width=this.width;
										}else{
											this.style.marginLeft=((" + media.mydef_widthLimit + "-this.width)/2)+'px';
										}
										if(this.height<=" + media.mydef_widthLimit + "){
											p.style.height=this.height;
										}else{
											this.style.marginTop=((" + media.mydef_heightLimit + "-this.height)/2)+'px';
										}" ?>
<?cs /def ?>

<?cs #:@info 在模版中按短边压缩图片的逻辑 ?>
<?cs #:@param [object] media 包含图片信息的object ?>
<?cs #:@param [number] media.mydef_imgurl 用来做为img节点的src的值 ?> 
<?cs #:@param [extend] media参数对象的其他属性依赖请看{@link:getReduceInfo} ?>
<?cs #:
	/**
	 * 在模版中按短边压缩图片的逻辑
	 * @param  {Object} media 包含图片信息的object
	 * @param  {String} media.mydef_widthLimit 图片展示区域的最大宽度
	 * @param  {String} media.mydef_heightLimit 图片展示区域的最大高度
	 * @param  {String} media.newWidth 图片的实际宽度
	 * @param  {String} media.newHeight 图片的实际高度
	 * @return undefined
	 */
	function PreReduceImageByShortEdge(media){}
?>
<?cs def:PreReduceImageByShortEdge(media) ?>
	<?cs call:getReduceInfo(media) ?>
	<?cs if: media.mydef_onload ?>
		<?cs set:getReduceInfo_Res.onload=media.mydef_onload ?>
	<?cs /if ?>
	<?cs call:m_printImageElement(media.mydef_imgurl,'','',"","",getReduceInfo_Res.onload,"",getReduceInfo_Res.short_pro) ?>
<?cs /def ?>

<?cs #:@info 在模版中按短边压缩图片的逻辑 ?>
<?cs #:@param [object] media 包含图片信息的object ?>
<?cs #:@param [number] media.mydef_imgurl 用来做为img节点的src的值 ?> 
<?cs #:@param [extend] media参数对象的其他属性依赖请看{link:getReduceInfo} ?>
<?cs #:
	/**
	 * 在模版中按短边压缩图片的逻辑
	 * @param {Object} media media 包含图片信息的object
	 * @param  {String} media.mydef_widthLimit 图片展示区域的最大宽度
	 * @param  {String} media.mydef_heightLimit 图片展示区域的最大高度
	 * @param  {String} media.newWidth 图片的实际宽度
	 * @param  {String} media.newHeight 图片的实际高度
	 * @return undefined
	 */
	function PreReduceImageByLongEdge(media){}
?>
<?cs def:PreReduceImageByLongEdge(media) ?>
	<?cs call:getReduceInfo(media) ?>
	<?cs if: media.mydef_onload ?>
		<?cs set:getReduceInfo_Res.onload=media.mydef_onload ?>
	<?cs /if ?>
	<?cs call:m_printImageElement(media.mydef_imgurl,'','',"","",getReduceInfo_Res.onload,"",getReduceInfo_Res.long_pro) ?>
<?cs /def ?>



<?cs #: =================================有高宽信息时的逻辑 END==================================== ?>


<?cs #:
	/**
	 * 选择mydef_imgurl
	 * @param  {[type]} media [description]
	 * @return {[type]}       [description]
	 */
	function selectImgUrl(media){}
?>
<?cs def:selectImgUrl(media) ?>
	<?cs if:media.picmarkflag==0 || !media.picmarksrc?>
		<?cs set:media.mydef_imgurl=media.src ?>
	<?cs else ?>
		<?cs set:media.mydef_imgurl=media.picmarksrc ?>
	<?cs /if ?>
<?cs /def ?>

<?cs #:构造一个reduceImage类型且具有fullscreenDialog弹层功能的img ?>
<?cs #:！！！！请注意关注这个方法对你特性的兼容性：qz:popup中写个stype是为了让首屏样式不乱，若有人在其它地方调用了这个方法,请注意关注这个style对你特性的兼容性： ?>
<?cs #:mode==1表示是用一张大图的分支，mode!=1是有多张图的 ?>

<?cs #:
	/**
	 * [popupReduceImageV2 description]
	 * @param  {[type]} media      [description]
	 * @param  {[type]} parentNode [description]
	 * @param  {[type]} mode       [description]
	 * @return {[type]}            [description]
	 */
	function popupReduceImageV2(media,parentNode,mode){}
?>
<?cs def:popupReduceImageV2(media,parentNode,mode) ?>
	<?cs #:这里蛋疼了，之前做相册的G+效果的时候没有顾及到popup由业务控制，后续得干掉else分支，兼容成以前的数据 ?>
	<?cs if:media.qz_popup.classNames ?>
		<?cs set:cls=media.qz_popup.classNames+' '+cls ?>
	<?cs /if ?>
	<?cs if:media.qz_popup.cssTexts ?>
		<?cs set:cst=media.qz_popup.cssTexts+cst ?>
	<?cs /if ?>

	<?cs if:subcount(media.qz_popup) > 0 ?>
		<a 
			data-cmd="qz_popup"  
			href="javascript:void(0)" 
			data-version="<?cs var:media.qz_popup.version ?>" 
			data-width="<?cs var:media.qz_popup.width ?>" 
			data-height="<?cs var:media.qz_popup.height ?>" 
			data-title="<?cs var:media.qz_popup.title ?>" 
			data-class="<?cs var:parentNode.cls ?> img_gif" 
			style="<?cs var:parentNode.sty ?>" 
			data-src="<?cs var:media.qz_popup.src ?>" 
			data-config="<?cs var:media.qz_popup.config ?>" 
			data-env="<?cs var:media.qz_popup.env ?>" 
			data-pickey="<?cs var:media.pickey ?>" 
			data-param="<?cs var:media.qz_popup.param ?>"
			class="<?cs var:parentNode.cls ?>  img_gif" >
	<?cs else ?>
		<a 
			data-cmd="qz_popup" 
			href="javascript:void(0)" 
			data-version="2" 
			data-width="<?cs var:media.width ?>" 
			data-height="<?cs var:media.height ?>" 
			title="" 
			class="<?cs var:parentNode.cls ?> img_gif" 
			style="<?cs var:parentNode.sty ?>" 
			data-src="/qzone/photo/zone/icenter_popup.html" 
			data-config="<?cs var:parentNode.config ?>" 
			data-pickey="<?cs var:media.pickey ?>" 
			data-param="<?cs var:qz_metadata.metadata.uin ?>|<?cs var:qz_metadata.content_box.media.albumid ?>|<?cs var:media.largeid ?>|<?cs var:media.src ?>">
	<?cs /if ?>
		<?cs if:media.newWidth || media.newHeight ?>
			<?cs #:有这两个东西就是有带了宽高信息，在模版里搞定展显逻辑 ?>
			<?cs if:mode==1 ?>
				<?cs call:PreReduceImageByLongEdge(media) ?>
			<?cs else ?>
				<?cs call:PreReduceImageByShortEdge(media) ?>
			<?cs /if ?>
		<?cs else ?>
			<?cs if:mode==1 ?>
				<?cs call:ReduceImageByLongEdge(media) ?>
			<?cs else ?>
				<?cs call:ReduceImageByShortEdge(media) ?>
			<?cs /if ?>
		<?cs /if ?>
	</a>
<?cs /def ?>

<?cs def:actionRedirectImageV2(media, parentNode,mode,tinyPic) ?>
	<a href="<?cs call:ugc_url_check(media.action,1) ?>" 
		class="<?cs alt:parentNode.cls ?><?cs /alt ?>" 
		style="<?cs alt:parentNode.sty ?><?cs /alt ?>" 
		target="_blank">
		<?cs #:mode==1表示是用一张大图的分支，mode!=1是有多张图的 ?>

		<?cs if:media.newWidth || media.newHeight ?>
			<?cs #:有这两个东西就是有带了宽高信息，在模版里搞定展显逻辑 ?>
			<?cs if:mode==1 ?>
				<?cs call:PreReduceImageByLongEdge(media) ?>
			<?cs else ?>
				<?cs call:PreReduceImageByShortEdge(media) ?>
				<?cs if:tinyPic==1 ?>
				<?cs if:media.vedioid?>
					<i class="ui_icon icon_video_sign_s"></i>
				<?cs /if?>
			<?cs /if?>
			<?cs /if ?>
		<?cs else ?>
			<?cs if:mode==1 ?>
				<?cs call:ReduceImageByLongEdge(media) ?>
			<?cs else ?>
				<?cs call:ReduceImageByShortEdge(media) ?>
				<?cs if:tinyPic==1 ?>
				<?cs if:media.vedioid?>
					<i class="ui_icon icon_video_sign_s"></i>
				<?cs /if?>
			<?cs /if?>
			<?cs /if ?>
		<?cs /if ?>
	</a>
<?cs /def ?>

<?cs def:reduceActionRouterV2(media,parentNode,mode,tinyPic) ?>
	<?cs if:media.picmarkflag==0 || !media.picmarksrc?>
		<?cs set:media.mydef_imgurl=media.src ?>
	<?cs else ?>
		<?cs set:media.mydef_imgurl=media.picmarksrc ?>
	<?cs /if ?>
	<?cs if:string.length(media.action) > 0 ?>
		<?cs call:actionRedirectImageV2(media, parentNode,mode,tinyPic) ?>
	<?cs else ?>
		<?cs call:popupReduceImageV2(media,parentNode,mode) ?>
	<?cs /if ?>
<?cs /def ?>

<?cs #:G+那种体验的图片查看 ?>
<?cs def:show_GPuls(medias) ?>
	<?cs if: medias.media.src ?>
		<?cs set:mydef_picCount=1 ?>
	<?cs else ?>
		<?cs set:mydef_picCount=subcount(medias.media) ?>
	<?cs /if ?>
	<div class="img_box">
	<?cs if:medias.media.src ?>
		<?cs #:只有一张图片 ?>
		<?cs set:mydef.mediaParent.cls="img_box_bigshow" ?>
		<?cs set:mydef.mediaParent.sty="width:400px;height:300px;overflow:hidden;" ?>
		<?cs set:mydef.mediaParent.width=400 ?>
		<?cs set:mydef.mediaParent.height=300 ?>
		<?cs set:medias.media.mydef_widthLimit=400 ?>
		<?cs set:medias.media.mydef_heightLimit=300 ?>
		<?cs call:selectImgUrl(medias.media) ?>
		<?cs call:reduceActionRouterV2(medias.media,mydef.mediaParent,1,0) ?>
		<?cs if:medias.albumtotalpic>0 ?>
			<p class="f_reprint c_tx3"><span class="ui_mr10">共有<?cs var:medias.albumtotalpic ?>张图片</span></p>
		<?cs /if ?>
	<?cs else ?>
		<?cs set:mydef.mediaParent.cls="img_box_bigshow" ?>
		<?cs set:mydef.mediaParent.sty="width:400px;height:300px;overflow:hidden;" ?>
		<?cs set:mydef.mediaParent.width=400 ?>
		<?cs set:mydef.mediaParent.height=300 ?>
		<?cs set:medias.media.0.mydef_widthLimit=400 ?>
		<?cs set:medias.media.0.mydef_heightLimit=300 ?>
		<?cs call:selectImgUrl(medias.media.0) ?>
		<?cs call:reduceActionRouterV2(medias.media.0,mydef.mediaParent,1,0) ?>
		<div class="img_box_preview">
			<?cs if:subcount(medias.media)-1>6 ?>
				<?cs set:len=6 ?>
			<?cs else ?>
				<?cs set:len=subcount(medias.media)-1 ?>
			<?cs /if ?>
			<?cs loop:i =1, len, 1 ?>
				<?cs set:mydef.mediaParent.cls="bg2" ?>
				<?cs set:mydef.mediaParent.sty="width:60px;height:45px;overflow:hidden;" ?>
				<?cs set:mydef.mediaParent.width=60 ?>
				<?cs set:mydef.mediaParent.height=45 ?>
				<?cs set:medias.media[i].mydef_widthLimit=60 ?>
				<?cs set:medias.media[i].mydef_heightLimit=45 ?>
				<?cs call:selectImgUrl(medias.media[i]) ?>
				<?cs call:reduceActionRouterV2(medias.media[i],mydef.mediaParent,2,1) ?>
			<?cs /loop ?>
			<?cs if:subcount(qz_metadata.content_box.mediatips) > 0?>
				<?cs call:ugc_url_check(medias.media[1].action,0) ?>
				<a class="img_box_count c_tx" href="<?cs if: ugc_url_check.ret ?><?cs var:ugc_url_check.ret ?><?cs else ?>javascript:;<?cs /if ?>" target="_blank"><?cs var:qz_metadata.content_box.mediatips.text ?></a>
			<?cs /if?>
			<?cs if:mydef_picCount>1 && medias.albumtotalpic>1 ?>
				<?cs if:subcount(medias.media[1].qz_popup) > 0 ?>
					<a 
						data-cmd="qz_popup" 
						href="javascript:void(0)" 
						data-version="<?cs var:medias.media[1].qz_popup.version ?>" 
						data-width="<?cs var:medias.media[1].qz_popup.width ?>" 
						data-height="<?cs var:medias.media[1].qz_popup.height ?>" 
						title="<?cs var:medias.media[1].qz_popup.title ?>" 
						class="img_box_count" 
						style="<?cs var:medias.media[1].qz_popup.cssTexts ?>" 
						data-src="<?cs var:medias.media[1].qz_popup.src ?>" 
						data-config="<?cs var:medias.media[1].qz_popup.config ?>" 
						data-env="<?cs var:medias.media[1].qz_popup.env ?>" 
						data-pickey="<?cs var:medias.media[1].pickey ?>" 
						data-param="<?cs var:medias.media[1].qz_popup.param ?>" 
					>
				<?cs else ?>
					<a 
						data-cmd="qz_popup" 
						href="javascript:void(0)" 
						data-version="2" 
						class="img_box_count" 
						data-src="/qzone/photo/zone/icenter_popup.html" 
						data-config="<?cs var:medias.media[1].config ?>" 
						data-pickey="<?cs var:medias.media[1].pickey ?>" 
						data-param="<?cs var:qz_metadata.metadata.uin ?>|
								<?cs var:qz_metadata.content_box.media.albumid ?>|
								<?cs var:medias.media[1].largeid ?>|
								<?cs call:htmlEncodeVar(medias.media[1].src, 2, 0) ?>" 
					>
				<?cs /if ?>
						共<?cs var:medias.albumtotalpic ?>张
				</a>
			<?cs /if ?>
		</div>
	<?cs /if ?>
	</div>
<?cs /def ?>

<?cs #:
	/**/
	function nineGridImage(media){}
?>
<?cs def:nineGridImage(medias) ?>
	<?cs set:mydef_inx = 1 ?>
	<?cs each:item=medias.media ?>
		<?cs set:mydef.mediaParent.cls="img_box_120x120 ui_mr8 bg2" ?>
		<?cs set:mydef.mediaParent.sty="width:128px;height:128px;overflow:hidden;display:inline-block;" ?>
		<?cs set:mydef.mediaParent.width=128 ?>
		<?cs set:mydef.mediaParent.height=128 ?>
		<?cs set:item.mydef_widthLimit=128 ?>
		<?cs set:item.mydef_heightLimit=128 ?>
		<?cs call:selectImgUrl(item) ?>
		<?cs call:htmlEncodeVar(item.mydef_imgurl,2,1) ?>
		<?cs set:item.mydef_onload="QZFL.media.reduceImage(1," + 
									item.mydef_widthLimit + "," + 
									item.mydef_heightLimit +
									",{
										trueSrc:restXHTML('" + htmlEncodeVar_Res + "'),
										callback:function(img,type,ew,eh,o){
											var p=img.parentNode,
												_h = Math.floor(o.oh/o.k),
												_w = Math.floor(o.ow/o.k);
											img.style.marginTop=(eh-_h)/2+'px';
											img.style.marginLeft=(ew-_w)/2+'px';
										}
									})" ?>
		<?cs if:mydef_inx == 1 ?>
			<div class="img_box" style="margin-top:4px;margin-bottom:4px;float:none;width:408px;">
		<?cs /if ?>
		<?cs call:reduceActionRouterV2(item,mydef.mediaParent,2,0) ?>
		<?cs if:mydef_inx == 3 ?>
			</div>
		<?cs /if ?>
		<?cs set:mydef_inx = mydef_inx+1 ?>
		<?cs if:mydef_inx ==4 ?>
			<?cs set:mydef_inx = 1 ?>
		<?cs /if ?>
	<?cs /each ?>
	<?cs if:mydef_inx !=1 ?>
		</div>
	<?cs /if ?>
<?cs /def ?>

<?cs #:G+那种体验的图片查看 ?>
<?cs def:photoViewWithSmartImage(medias,mod) ?>
	<?cs if: medias.media.src ?>
		<?cs set:mydef_picCount = 1 ?>
	<?cs else ?>
		<?cs set:mydef_picCount = subcount(medias.media) ?>
	<?cs /if ?>
	<?cs if:medias.newtype== 2 || mydef_picCount == 1?>
		<?cs call:show_GPuls(medias) ?>
	<?cs elif:mydef_picCount == 2 ?>
		<?cs #:只有两张图片 ?>
		<?cs set:mydef.mediaParent.cls="img_box_200x200 ui_mr8" ?>
		<?cs set:mydef.mediaParent.sty="width:196px;height:196px;overflow:hidden;" ?>
		<?cs set:mydef.mediaParent.width=196 ?>
		<?cs set:mydef.mediaParent.height=196 ?>
		<div class="img_box" style="margin-top:4px;margin-bottom:4px;float:none;width:408px;">
			<?cs each:item=medias.media ?>
				<?cs set:item.mydef_widthLimit=196 ?>
				<?cs set:item.mydef_heightLimit=196 ?>
				<?cs call:selectImgUrl(item) ?>
				<?cs call:reduceActionRouterV2(item,mydef.mediaParent,2,0) ?>
			<?cs /each ?>
		</div>
	<?cs elif:mydef_picCount == 3 ?>
		<?cs call:nineGridImage(medias) ?>
	<?cs elif:mydef_picCount > 3 && medias.newtype == 1 ?>
		<?cs call:show_GPuls(medias) ?>
	<?cs elif:mydef_picCount == 4 ?>
		<?cs set:mydef.mediaParent.cls = "img_box_200x200 ui_mr8 bg2" ?>
		<?cs set:mydef.mediaParent.sty = "width:196px;height:196px;overflow:hidden;" ?>
		<?cs set:mydef.mediaParent.width=196 ?>
		<?cs set:mydef.mediaParent.height=196 ?>
		<?cs set:mydef_inx = 1 ?>
		<?cs each:item=medias.media ?>
			<?cs if:mydef_inx == 1 ?>
				<div class="img_box" style="margin-top:4px;margin-bottom:4px;float:none;width:408px;">
			<?cs /if ?>
			<?cs set:item.mydef_widthLimit=196 ?>
			<?cs set:item.mydef_heightLimit=196 ?>
			<?cs call:selectImgUrl(item) ?>
			<?cs call:htmlEncodeVar(item.mydef_imgurl,2,1) ?>
			<?cs set:item.mydef_onload="QZFL.media.reduceImage(1," + 
										item.mydef_widthLimit+"," +
										item.mydef_heightLimit + 
										",{
											trueSrc:restXHTML('" + item.mydef_imgurl + "'),
											callback:function(img,type,ew,eh,o){
												var p=img.parentNode,
													_h = Math.floor(o.oh/o.k),
													_w = Math.floor(o.ow/o.k);
												img.style.marginTop=(eh-_h)/2+'px';
												img.style.marginLeft=(ew-_w)/2+'px';
											}
										})" ?>
			<?cs call:reduceActionRouterV2(item,mydef.mediaParent,2,0) ?>
			<?cs if:mydef_inx == 2 ?>
				</div>
			<?cs /if ?>
			<?cs set:mydef_inx = mydef_inx+1 ?>
			<?cs if:mydef_inx == 3 ?>
				<?cs set:mydef_inx = 1 ?>
			<?cs /if ?>
		<?cs /each ?>
		<?cs if:mydef_inx != 1 ?>
			</div>
		<?cs /if ?>
	<?cs elif:mydef_picCount >= 5 ?>
		<?cs call:nineGridImage(medias) ?>
	<?cs /if ?>
<?cs /def ?>


<?cs def:contentBoxCommon-img(mod, isShowOnePic) ?>
	<?cs if:qz_metadata.content_box.media || 
			qz_metadata.content_box.media.media.src || 
			qz_metadata.content_box.media.media.type || 
			qz_metadata.content_box.media.media.0.src || 
			qz_metadata.content_box.media.media.0.avatar ?>
		<?cs if:qz_metadata.content_box.media.newtype ?>
			<?cs call:photoViewWithSmartImage(qz_metadata.content_box.media,mod) ?>
		<?cs else ?>
			<div class="img_box"
				 richinfo="<?cs var:qz_metadata.content_box.media.media.qz_popup.param ?>" 
				 url1="<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src,2,0) ?>" 
				 url2="<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src_big,2,0) ?>" 
				 url3="<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src_org,2,0) ?>"
			>
				<?cs #:多张图而且弹出框的情况 ?>
				<?cs if:qz_metadata.content_box.media.media.0.src  && subcount(qz_metadata.content_box.media.media.0.qz_popup) > 0 ?>
					<?cs if:isShowOnePic ?>
						<a 
							data-cmd="qz_popup" 
							href="javascript:void(0)" 
							data-version="<?cs var:qz_metadata.content_box.media.media.0.qz_popup.version ?>" 
							data-width="<?cs var:qz_metadata.content_box.media.media.0.qz_popup.width ?>" 
							data-height="<?cs var:qz_metadata.content_box.media.media.0.qz_popup.height ?>" 
							title="<?cs var:qz_metadata.content_box.media.media.0.qz_popup.title ?>" 
							data-src="<?cs var:qz_metadata.content_box.media.media.0.qz_popup.src ?>" 
							data-config="<?cs var:qz_metadata.content_box.media.media.0.qz_popup.config ?>" 
							class="img_gif" 
							data-env="<?cs var:qz_metadata.content_box.media.media.0.qz_popup.env ?>" 
							data-pickey="<?cs var:qz_metadata.content_box.media.media.0.pickey ?>" 
							data-param="<?cs var:qz_metadata.content_box.media.media.0.qz_popup.param ?>"
						>
							<?cs call:imageFlag(qz_metadata.content_box.media.media.0.phototype) ?>
							<img src="/ac/b.gif" 
								onload="QZFL.media.adjustImageSize(120,120,
									restXHTML('<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.0.src,2,0) ?>'));" />
						</a>
					<?cs else ?>
					<?cs each:item = qz_metadata.content_box.media.media ?>
						<a 
							data-cmd="qz_popup" 
							href="javascript:void(0)" 
							data-version="<?cs var:item.qz_popup.version ?>" 
							data-width="<?cs var:item.qz_popup.width ?>" 
							data-height="<?cs var:item.qz_popup.height ?>" 
							title="<?cs var:item.qz_popup.title ?>" 
							data-src="<?cs var:item.qz_popup.src ?>" 
							data-config="<?cs var:item.qz_popup.config ?>" 
							class="img_gif" 
							data-env="<?cs var:item.qz_popup.env ?>" 
							data-pickey="<?cs var:item.pickey ?>" 
							data-param="<?cs var:item.qz_popup.param ?>"
						>
							<?cs call:imageFlag(item.phototype) ?>
							<img src="/ac/b.gif" 
								onload="QZFL.media.adjustImageSize(120,120,restXHTML('<?cs call:htmlEncodeVar(item.src,2,0) ?>'));" />
						</a>
					<?cs /each ?>
					<?cs /if ?>
				<?cs #:多张且是app的情况 ?>
				<?cs elif: qz_metadata.content_box.media.media.0.src && qz_metadata.content_box.media.media.0.aid ?>
					<?cs each:item = qz_metadata.content_box.media.media ?>
						<a class="appfeed_icon" target="_blank" href="http://rc.qzone.qq.com/myhome/<?cs var:item.aid?>">
							<img src="/ac/b.gif" 
								onload="QZFL.media.adjustImageSize(50,50,
									restXHTML('<?cs call:htmlEncodeVar(item.src,2,0) ?>'));"/>
						</a>
					<?cs /each ?>
				<?cs #:多张且是链接跳走的情况?>
				<?cs elif:qz_metadata.content_box.media.media.0.action ?>
					<?cs each:item = qz_metadata.content_box.media.media ?>
						<a href="<?cs call:ugc_url_check(item.action,1) ?>" class="img_gif" target="_blank">
						<?cs if:item.avatar ?>
							<?cs call:imageFlag(item.phototype) ?>
							<img src="/ac/b.gif" 
								class="q_namecard" 
								link="nameCard_<?cs var:item.uin ?> des_<?cs var:item.uin ?>" 
								onload="QZFL.media.adjustImageSize(120,120,restXHTML('<?cs call:htmlEncodeVar(item.avatar,2,0) ?>'));"
							/>
						<?cs else ?>
							<?cs call:imageFlag(item.phototype) ?><img src="<?cs call:htmlEncodeVar(item.src,2,0) ?>" />
						<?cs /if ?>
						</a>
					<?cs /each ?>
				<?cs elif:qz_metadata.content_box.media.media.src ||qz_metadata.content_box.media.media.type ?>
					<?cs #:一张的情况 ?>
					<?cs if:qz_metadata.content_box.media.media.type == 'video' ?>
						<?cs with:media = qz_metadata.content_box.media.media?>
						<a 
							data-cmd="qz_popup" 
							href="javascript:void(0)" 
							data-height="<?cs var:media.qz_popup.height ?>" 
							data-src="<?cs var:media.qz_popup.src ?>" 
							data-width="<?cs var:media.qz_popup.width ?>" 
							data-param="<?cs var:media.qz_popup.param ?>" 
							data-env="<?cs var:media.qz_popup.env ?>" 
							data-version="<?cs var:media.qz_popup.version ?>"
							>
							<?cs set: media_is_bigimg = 0?>
							<?cs if:media.preview == 'big' || media.isbimg == 1 ?><?cs set: media_is_bigimg = 1?><?cs /if?>
							<span class="video_preview<?cs if:media_is_bigimg?>_big<?cs /if?><?cs if:media.phototype==3?> img_document<?cs /if?>">
								<?cs if:media.phototype==3?>
									<?cs call:imageFlag(media.phototype) ?><?cs #:文档类型给打个角标?>
								<?cs else?>
									<span class="video_play_bt">　</span>
								<?cs /if?>
								<img alt="视频缩略图" src="/ac/b.gif" 
									onload="QZFL.media.adjustImageSize(
										<?cs if:media_is_bigimg ?>400,400<?cs else ?>120,120<?cs /if?>,
										restXHTML('<?cs call:htmlEncodeVar(media.src,2,0) ?>'));" />
							</span>
						</a>
						<?cs /with ?>
					<?cs elif:qz_metadata.content_box.media.media.type == 'music' ?>
						<div class="f_ct_music controls_<?cs var:qz_metadata.content_box.media.media.itemid?>">
							<a 
								data-cmd="qz_popup" 
								href="javascript:void(0)" 
								data-param="<?cs var:qz_metadata.content_box.media.media.qz_popup.param ?>" 
								data-version="4" 
								data-src="/music/qzone/music_ic.js" 
								data-needContainer="1" 
								data-charset="utf-8" 
								data-width="375" 
								data-height="169" 
								data-type="Music">
							<span class="music_playbt bor2">
								<span class="music_playbt_i bor2"><b class="trig c_tx"></b><i class="c_tx">播放</i></span>
							</span>
							</a>
							<span class="music_playtime c_tx3"><?cs var:qz_metadata.content_box.media.media.musictime ?></span>
						</div>
						<div class="f_ct_song_player player_<?cs var:qz_metadata.content_box.media.media.itemid?>" style="display:none;">
							<a 
								data-cmd="qz_popup" 
								href="javascript:void(0)" 
								data-param="{action:4<?cs var:string.slice(qz_metadata.content_box.media.media.qz_popup.param,9, string.length(qz_metadata.content_box.media.media.qz_popup.param)) ?>"  
								data-src="/music/qzone/music_ic.js" 
								data-needContainer="1" 
								data-version="4" 
								data-charset="utf-8" 
								data-width="375" 
								data-height="169" 
								data-type="Music">收起</a>
							<div class="flash_<?cs var:qz_metadata.content_box.media.media.itemid?>"></div>
						</div>
					<?cs elif:qz_metadata.content_box.media.media.type == 'script' ?>
						<?cs with: media = qz_metadata.content_box.media.media?>
						<?cs if:media.biz == "mall" ?>
							<a class="c_tx ui_mr10" href="javascript:;" onclick="QZONE.ICFeeds.Interface.checkForDress2(this,'<?cs var:media.param[0]?>', '<?cs var:media.param[1] ?>')">
							<img src="/ac/b.gif" onload="QZFL.media.adjustImageSize(
								430,430,restXHTML('<?cs call:htmlEncodeVar(media.src,2,0) ?>'));"/>
						</a>
					<?cs /if ?>
					<?cs /with?>
				<?cs else ?>
					<?cs if:subcount(qz_metadata.content_box.media.media.qz_popup) > 0 ?>
						<a 
							data-cmd="qz_popup" 
							href="javascript:void(0)" 
							data-version="<?cs var:qz_metadata.content_box.media.media.qz_popup.version ?>" 
							data-width="<?cs var:qz_metadata.content_box.media.media.qz_popup.width ?>" 
							data-height="<?cs var:qz_metadata.content_box.media.media.qz_popup.height ?>" 
							title="<?cs var:qz_metadata.content_box.media.media.qz_popup.title ?>" 
							data-src="<?cs var:qz_metadata.content_box.media.media.qz_popup.src ?>" 
							data-config="<?cs var:qz_metadata.content_box.media.media.qz_popup.config ?>" 
							class="img_gif" 
							data-pickey="<?cs var:qz_metadata.content_box.media.media.qz_popup.pickey ?>" 
							data-topicid="<?cs var:qz_metadata.content_box.media.media.qz_popup.topicid ?>" 
							data-pre="<?cs var:qz_metadata.content_box.media.media.qz_popup.pre ?>" 
							data-appid="<?cs var:qz_metadata.content_box.media.media.qz_popup.appid ?>" 
							data-env="<?cs var:qz_metadata.content_box.media.media.qz_popup.env ?>" 
							data-param="<?cs var:qz_metadata.content_box.media.media.qz_popup.param ?>"
						>
							<?cs call:imageFlag(qz_metadata.content_box.media.media.phototype) ?>
							<img src="/ac/b.gif" 
								onload="QZFL.media.adjustImageSize(120,120,
										restXHTML('<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src,2,0) ?>'));" />
						</a>
					<?cs elif:qz_metadata.content_box.media.media.action ?>
						<?cs #:链接跳走的情况 ?>
						<?cs with:media = qz_metadata.content_box.media.media?>
							<?cs if:media.vedioid?>
								<a class="img_video" target="_blank" href="<?cs call:ugc_url_check(media.action,1) ?>">
									<i class="ui_icon icon_video_sign"></i>
									<img src="/ac/b.gif" onload="QZFL.media.adjustImageSize(120,120,
											restXHTML('<?cs call:htmlEncodeVar(media.src,2,0) ?>'))" />
								</a>
							<?cs #:邀请我一起看 ?>
							<?cs elif:qz_metadata.feedtitle.content.con.0=='邀请我一起看' ?>
								<a class="img_box_width100" href="<?cs call:ugc_url_check(media.action,1) ?>" target="_blank">
									<img src="<?cs call:htmlEncodeVar(media.src,2,0) ?>"/>
								</a>
							<?cs else ?>
								<a href="<?cs call:ugc_url_check(media.action,1) ?>" target="_blank">
								<?cs if:media.avatar ?>
									<img src="/ac/b.gif" 
										class="q_namecard" 
										link="nameCard_<?cs var:media.uin ?> des_<?cs var:media.uin ?>" 
										onload="QZFL.media.adjustImageSize(50,50,
											restXHTML('<?cs call:htmlEncodeVar(media.avatar,2,0) ?>'));" />
									<?cs else ?>
										<img src="/ac/b.gif" 
										onload="QZFL.media.adjustImageSize(
											<?cs alt:media.width?>400<?cs /alt?>,<?cs alt:media.height?>400<?cs /alt ?>,
											restXHTML('<?cs call:htmlEncodeVar(media.src,2,0) ?>'));" />
								<?cs /if ?>
								</a>
							<?cs /if?>
						<?cs /with ?>
					<?cs elif:qz_metadata.content_box.media.media.aid ?>
						<?cs #:空间内应用跳转的情况 /*deprecated*/ 2012 中 可删除?>
						<?cs with:appMedia = qz_metadata.content_box.media.media?>
						<a target="_blank" href="http://rc.qzone.qq.com/myhome/<?cs var:appMedia.aid?>">
							<img src="/ac/b.gif" 
								onload="QZFL.media.adjustImageSize(75,75,restXHTML('<?cs call:htmlEncodeVar(appMedia.src,2,0) ?>'));"/>
						</a>
						<?cs /with ?>
					<?cs elif:qz_metadata.content_box.media.media.src_org ?>
							<a href="javascript:;" 
								onclick="QZFL.widget.simpleImageViewer.show(
									this.parentNode,
									'<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src_big,1,0) ?>',
									'<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src_ori,1,0) ?>',
									374, 0, 0);return false;" 
								class="<?cs if:qz_metadata.content_box.media.media.phototype == "2" ?> img_gif<?cs /if ?>"
							>
								<?cs call:imageFlag(qz_metadata.content_box.media.media.phototype) ?>
								<img src="/ac/b.gif" 
									onload="QZFL.media.adjustImageSize(200,300,
											restXHTML('<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src,2,0) ?>'));"/>
							</a>
						<?cs else ?>
							<img src="/ac/b.gif" 
								onload="QZFL.media.adjustImageSize(410,430,
									restXHTML('<?cs call:htmlEncodeVar(qz_metadata.content_box.media.media.src,2,0) ?>'));" />
						<?cs /if ?>
					<?cs /if ?>

				<?cs /if ?>
				<?cs #cs要是好用一点，在这里加一个hook多好...! 生日礼物要加一个特殊的图片 ?>
				<?cs if:subcount(qz_metadata.content_box.media.extend.birthday) > 0?>
					<?cs with:popup=qz_metadata.content_box.media.extend.birthday.qz_popup?>
					<a 
						data-cmd="qz_popup" 
						href="javascript:void(0)" 
						title="<?cs var:popup.title ?>" 
						data-width="<?cs var:popup.width ?>" 
						data-height="<?cs var:popup.height ?>" 
						data-version="<?cs var:popup.version ?>" 
						data-src="<?cs var:popup.src ?>" 
						data-param="<?cs var:popup.param ?>" >
						<span href="javascript:;" title="<?cs var:popup.title ?>" class="btn_gift"></span>
					</a>
					<?cs /with ?>
				<?cs /if?>
			</div>
		<?cs /if ?>
	<?cs /if ?>
<?cs /def ?>


	<?cs def:contentSubTitleItem(item) ?>
		<?cs if:item.type == "url"?>
			<a href="<?cs call:ugc_url_check(item.url,1) ?>" class="c_tx" target="_blank"><?cs var:item.text ?></a>
		<?cs elif:item.type == "text"?>
			<?cs var:item.text ?>
		<?cs elif:item.type == "nick" ?>
			<?cs call:userLink(item,"") ?>
		<?cs elif:item.type == "qz_app" ?>
			<a class="c_tx" target="_blank" href="http://rc.qzone.qq.com/myhome/<?cs var:item.aid?>">
				<?cs var:item.text ?>
			</a>
		<?cs elif:item.type == 'script' ?>
			<?cs if:item.biz == "mall"?>
				<a class="c_tx" href="javascript:;" onclick="QZONE.ICFeeds.Interface.checkForDress2(this,'<?cs var:item.param[0]?>', '<?cs var:item.param[1] ?>')">
					<?cs var:item.text ?>
				</a>
			<?cs /if ?>
		<?cs else ?>
			<?cs var:item ?>
		<?cs /if ?>
	<?cs /def ?>

<?cs def:contentBoxCommon-txt(mod, isVideo) ?>
<?cs #isVideo:是否视频类 isMargin:是否加边距 ?>
	<?cs if:qz_metadata.content_box.detailurl || 
			subcount(qz_metadata.content_box[qz_content_name]) || 
			( subcount(qz_metadata.content_box.voice)
				&& qz_metadata.content_box.voice_type == 1) ||
			subcount(qz_metadata.content_box.title)  ?>

			<?cs if:qz_metadata.content_box[qz_content_name].con.type =='qz_app' ?>

				<?cs set:qz_cont_box_class = 'appfeed_info' ?>
			<?cs elif:(qz_metadata.content_box.voice_type == 1 &&
						subcount(qz_metadata.content_box.voice)) ?>
				<?cs set:qz_cont_box_class = 'audio_box' ?>
			<?cs elif:subcount(qz_metadata.content_box.con_more)>0?>
				<?cs #:说说截断，有双div.txt_box ?>
				<?cs set:qz_cont_box_class = 'txt_box info_cut'?>
			<?cs else ?>
				<?cs #:默认为.txt_box ?>
				<?cs set:qz_cont_box_class = 'txt_box' ?>
			<?cs /if ?>

			<div class="<?cs var:qz_cont_box_class ?>">
			<?cs if:subcount(qz_metadata.content_box.title) > 0 && mod.hidetitle!='true' ?>
			<h4 class="txt_box_title">
				<?cs if:subcount(qz_metadata.content_box.title.con.0) > 0 ?>
					<?cs each:item = qz_metadata.content_box.title.con ?>
						<?cs call:contentSubTitleItem(item) ?>
					<?cs /each ?>
				<?cs elif:subcount(qz_metadata.content_box.title.con) > 0 ?>
					<?cs call:contentSubTitleItem(qz_metadata.content_box.title.con) ?>
				<?cs elif:subcount(qz_metadata.content_box.title) > 0 ?>
					<?cs if:qz_metadata.content_box.title.url ?>
						<a href="<?cs call:ugc_url_check(qz_metadata.content_box.title.url,1) ?>" target="_blank"><?cs var:qz_metadata.content_box.title.text ?></a>
					<?cs /if ?>
				<?cs /if ?>
			</h4>
			<?cs /if ?>
			<?cs #:来自组件 ?>
			<?cs if:source_in_content?>
				<?cs if:qz_metadata.extend_info.info.type == 'source' ?>
					<?cs call:iconSource(qz_metadata.extend_info.info) ?>
				<?cs /if ?>
				<?cs if:qz_metadata.extend_info.info.0.type == 'source' ?>
					<?cs call:iconSource(qz_metadata.extend_info.info.0) ?>
				<?cs /if ?>
			<?cs /if ?>
			<?cs if:subcount(qz_metadata.content_box[qz_orginuser_name]) ?><?cs call:userLink(qz_metadata.content_box[qz_orginuser_name],'') ?>：<?cs /if ?>

			<?cs if:qz_metadata.content_box.bgid && mod.blogTemplate==1?><?cs #模板日志 ?>
			<?cs with:bgid =qz_metadata.content_box.bgid ?>
				<div style="background:url('http://qzs.qq.com/qzone/space_item/orig/<?cs var:bgid % 16?>/<?cs var:bgid?>/feed.png')" class="txt_blog_template">
					<div class="blog_template_mask"></div>
					<i class="ui_icon blog_template_icon icon_blog_template"></i>
					<div class="blog_template_text"><?cs var:qz_metadata.content_box[qz_content_name].con?></div>
					<a class="blog_template_link" href="<?cs call:ugc_url_check(qz_metadata.content_box.detailurl,1) ?>" target="_blank"></a>
				</div>
			<?cs /with ?>
			<?cs else ?>
				<?cs call:contentBox-inline-voice()?><?cs #说说语音都放在前面?>
				<?cs call:richContent(qz_metadata.content_box[qz_content_name]) ?>
			<?cs /if ?>
			</div>

			<?cs #:说说截断，有双div.txt_box ?>
			<?cs if:qz_cont_box_class == 'txt_box info_cut'?>
			<div class="txt_box info_complete none"></div>
			<div class="txt_box f_toggle">
				<a href="javascript:;" data-cmd="qz_toggle" data-action="<?cs var:qz_metadata.content_box.con_more.action ?>" data-param="<?cs var:qz_metadata.content_box.con_more.param ?>" data-complete=0 data-isshuoshuo=2>展开查看全文</a>
				<img src="http://qzonestyle.gtimg.cn/qzone_v6/img/feed/loading.gif" class="load_img none" />
			</div>
			<?cs /if?>
	<?cs /if ?>
<?cs /def ?>
<?cs #:
	function with_hr_title(param){}
?>
<?cs def:with_hr_title(mod,user,item,appid) ?>
	<?cs if: subcount(user) ?>
		<div class="f_ct_title">
			<?cs call:userLink(user,"") ?>
			<span class="c_tx3">
			<?cs if: qz_metadata.metadata.appid==217 ?>
				转：
			<?cs else ?>
				<?cs var:mod.actionText ?>
				<?cs if:!subcount(item.0)&&!string.length(item) ?>
					了此条信息
				<?cs else ?>
					<?cs var:mod.actionPrating ?>
				<?cs /if ?>
			<?cs /if ?>
			</span>
			<?cs if:subcount(item) && (subcount(item.0)||string.length(item.0)) ?>

				<?cs set:_hr=1 ?>
				<?cs loop:i=0, subcount(item)-1, 1 ?>
					<?cs call:contentSubTitleItem(item[i]) ?>
				<?cs /loop ?>
			<?cs elif:subcount(item)||string.length(item) ?>
				<?cs set:_hr=1 ?>
				<?cs call:contentSubTitleItem(item) ?>
			<?cs /if ?>
		</div>
		<div class="f_ang_t bor2"></div>
	<?cs /if ?>
<?cs /def ?>

<?cs #:元数据兼容 ?>
<?cs set:qz_content_name = 'content' ?>
<?cs if:subcount(qz_metadata.content_box.content_2) >0 ?>
	<?cs set:qz_content_name = 'content_2' ?>
<?cs /if ?>

<?cs set:qz_orginuser_name = 'orginuser' ?>
<?cs if:subcount(qz_metadata.content_box.orginuser_2) > 0 ?>
	<?cs set:qz_orginuser_name = 'orginuser_2' ?>
<?cs /if ?>

<?cs #:摘要区域 ?>
<?cs def:contentBoxCommon(type, mod) ?>

	<?cs #:默认的摘要 无框无背景色 				f_ct ?>
	<?cs #:摘要表现1 带左边框 					f_ct f_ct_1 bor3 ?>
	<?cs #:摘要表现2 边框 + 背景色				f_ct f_ct_2 bor3 bg3 ?>

	<?cs #:元数据兼容 ?>
	<?cs set:qz_content_name = 'content' ?>
	<?cs if:subcount(qz_metadata.content_box.content_2) >0 ?>
		<?cs set:qz_content_name = 'content_2' ?>
	<?cs /if ?>

	<?cs set:qz_orginuser_name = 'orginuser' ?>
	<?cs if:subcount(qz_metadata.content_box.orginuser_2) > 0 ?>
		<?cs set:qz_orginuser_name = 'orginuser_2' ?>
	<?cs /if ?>

	<?cs if:mod.contentHide==1 ?>
		<?cs set:className=type+" none _contentBox_" ?>
	<?cs else ?>
		<?cs set:className=type ?>
	<?cs /if ?>
	<?cs if:subcount(qz_metadata.magicemotion) || 
			subcount(qz_metadata.content_box.title) > 0 || 
			subcount(qz_metadata.content_box.media) || 
			subcount(qz_metadata.vote_box) || 
			subcount(qz_metadata.lbs) || 
			subcount(qz_metadata.attach) || 
			subcount(qz_metadata.profile) || 
			subcount(qz_metadata.content_box[qz_content_name]) || 
			subcount(qz_metadata.music_box) || 
			subcount(qz_metadata.clock_box) || 
			subcount(qz_metadata.content_box.voice)?>
	<div class="<?cs var:className ?>">

		<?cs if:mod.with_hr==1 && subcount(qz_metadata.metadata.lastmsg) && qz_metadata.metadata.lastmsg.visiable==1 ?>
			<?cs call:with_hr_title(mod,qz_metadata.metadata.lastmsg.user,qz_metadata.metadata.lastmsg.con,qz_metadata.metadata.lastmsg.appid) ?>
			<?cs if: qz_metadata.metadata.appid==311 ?>
				<?cs set:qz_content_name="content" ?>
				<?cs set:qz_orginuser_name = 'orginuser' ?>
			<?cs /if ?>
		<?cs /if ?>
		<?cs call:subTitle()?>
		<?cs if:subcount(qz_metadata.magicemotion) || 
				subcount(qz_metadata.content_box.title) > 0 || 
				subcount(qz_metadata.content_box[qz_content_name]) ||
				subcount(qz_metadata.extend_info.sameusers) ||
				subcount(qz_metadata.content_box.voice) ||
				qz_metadata.content_box.detailurl || 
				qz_metadata.content_box.media ||
				qz_metadata.content_box.media.media.src || 
				qz_metadata.content_box.media.media.0.src || 
				qz_metadata.content_box.media.media.0.avatar ?>
			<?cs set:qz_is_txtimg_class = '' ?>
			<?cs if:(	subcount(qz_metadata.content_box[qz_content_name]) > 0 || 
						subcount(qz_metadata.content_box.title) > 0 ||
						qz_metadata.content_box.media || 
						qz_metadata.content_box.media.media.src || 
						qz_metadata.content_box.media.media.0.src
					) ?>
				<?cs set:qz_is_txtimg_class = 'f_ct_txtimg' ?>
			<?cs /if ?>

			<?cs set:qz_custom_ct_class = '' ?>
			<?cs if:qz_metadata.content_box.media.media.0.aid ?>
				<?cs #:如果是appstore feeds ?>
				<?cs set:qz_custom_ct_class = ' f_ct_appfeed' ?>
			<?cs else ?>
				<?cs #:默认为.f_c_imgtxt?>
				<?cs set:qz_custom_ct_class = ' f_ct_imgtxt' ?>
			<?cs /if ?>

			<div class="<?cs var:qz_custom_ct_class ?> <?cs var:qz_is_txtimg_class ?>">
				<?cs call:contentBox-block-voice()?>
				<?cs #:文本区域 ?>
				<?cs call:contentBoxCommon-txt(mod, 0) ?>
				<?cs #:判断下有木有图片或者视频 ?>
				<?cs call:contentBoxCommon-img(mod, 0) ?>
				<?cs call:attachmentMagicemotionPresenter() ?>
				<?cs call:sameUserList(10) ?>
			</div>
		<?cs /if ?>
		<?cs call:music(mod) ?>
		<?cs call:profileViewer(mod) ?>
		<?cs call:clockBoxViewer()?>
		<?cs call:attachViewer(mod) ?>
		<?cs call:voteViewer(mod) ?>
		<?cs call:coupon(mod) ?>
		<?cs call:tieban(mod) ?>
		<?cs call:attachInfo(mod) ?>
		<div class="f_reprint_box">
			<?cs call:locationInfo(mod) ?>
			<?cs call:extendInfo(mod) ?>
		</div>
	</div>
	<?cs /if ?>
<?cs /def ?>

<?cs #:摘要区域左图右文 ?>
<?cs def:contentBoxCommonLeftImage(type, mod) ?>
	<?cs #:默认的摘要 无框无背景色 				f_ct ?>
	<?cs #:摘要表现1 带左边框 					f_ct f_ct_1 bor3 ?>
	<?cs #:摘要表现2 边框 + 背景色				f_ct f_ct_2 bor3 bg3 ?>
	<?cs if:subcount(qz_metadata.content_box) > 0  || subcount(qz_metadata.vote_box) > 0 || subcount(qz_metadata.extend_info) > 0 || subcount(qz_metadata.lbs) > 0 ?>
	<?cs set:qz_contentBox_type = qz_metadata.content_box.type ?>
	<?cs set:qz_is_txtimg = 0 ?>
	<?cs set:qz_is_txtimg_class = '' ?>
	<?cs set:qz_custom_ct_class='' ?>
	<?cs if:qz_contentBox_type == 'blog' || qz_contentBox_type == 'video' || qz_contentBox_type == 'pic' || qz_contentBox_type == 'music'?>
		<?cs set:qz_is_txtimg = 1 ?>
		<?cs set:qz_is_txtimg_class = ' f_ct_txtimg' ?>
	<?cs /if ?>

	<?cs if:qz_metadata.content_box[qz_content_name].con.type == 'qz_app' ?>
		<?cs #:如果是appstore feeds ?>
		<?cs set:qz_custom_ct_class=' f_ct_appfeed' ?>
	<?cs /if ?>

	<?cs if:mod.contentHide==1 ?>
		<?cs set:className=type+" none _contentBox_" ?>
	<?cs else ?>
		<?cs set:className=type ?>
	<?cs /if ?>
	<div class="<?cs var:className ?>">
		<div class="f_ct_imgtxt <?cs var:qz_custom_ct_class ?> <?cs if:subcount(qz_metadata.content_box[qz_content_name]) > 0  && qz_is_txtimg ?><?cs var:qz_is_txtimg_class ?><?cs /if ?>">
		<?cs call:subTitle()?>
		<?cs if:qz_is_txtimg?>
			<?cs call:contentBoxCommon-txt(mod, 1) ?>
			<?cs call:contentBoxCommon-img(mod, 0) ?>
		<?cs else ?>
		<?cs #:判断下有木有图片或者视频 ?>
			<?cs call:contentBoxCommon-img(mod, 1) ?>
			<?cs #:文本区域 ?>
			<?cs call:contentBoxCommon-txt(mod, 0) ?>
		<?cs /if ?>
		<?cs call:markPhotoInfo(mod) ?>
		<?cs call:sameUserList(10) ?>
		</div>
		<?cs call:voteViewer(mod) ?>
		<?cs call:coupon(mod) ?>
		<div class="f_reprint_box">
			<?cs call:locationInfo(mod) ?>
			<?cs call:extendInfo(mod) ?>
		</div>
	</div>
	<?cs /if ?>
<?cs /def ?>

<?cs #:默认的摘要 无框无背景色 				f_ct ?>
<?cs def:contentBox(mod)?>
	<?cs #:qz_metadata.content_box.media.newtype是为兼容被动feeds的老数据设置的 ?>
	<?cs #游戏试玩feed直达通道 ?>
	<?cs if:qz_metadata.content_box.media.media.game == 1 ?>
		<?cs call:game() ?>
	<?cs elif:qz_metadata.content_box[qz_content_name].con.type == 'qz_app' ||  (qz_metadata.content_box.media.media.avatar && qz_metadata.metadata.appid == 217) ?>
		<?cs #:如果是应用的话，需要跟据数据来判断是不是左图右文 ?>
		<?cs call:contentBoxCommonLeftImage('f_ct', mod) ?>
	<?cs else ?>
		<?cs call:contentBoxCommon('f_ct', mod) ?>
	<?cs /if ?>
<?cs /def ?>

<?cs #:摘要表现1 带左边框 					f_ct f_ct_1 bor3 ?>
<?cs def:contentBoxLeftBor(mod) ?>
	<?cs call:contentBoxCommon('f_ct f_ct_1 bor3', mod) ?>
<?cs /def ?>

<?cs #:摘要表现2 边框 + 背景色				f_ct f_ct_2 bor3 bg3 ?>
<?cs def:contentBoxLeftBorBg(mod) ?>
	<?cs call:contentBoxCommon('f_ct f_ct_2 bor3 bg3', mod) ?>
<?cs /def ?>


<?cs #:默认的摘要 无框无背景色 				f_ct ?>
<?cs def:contentBoxLeftImage(mod)?>
	<?cs call:contentBoxCommonLeftImage('f_ct', mod) ?>
<?cs /def ?>

<?cs #:摘要表现1 带左边框 					f_ct f_ct_1 bor3 ?>
<?cs def:contentBoxLeftBorLeftImage(mod) ?>
	<?cs call:contentBoxCommonLeftImage('f_ct f_ct_1 bor3', mod) ?>
<?cs /def ?>

<?cs #:摘要表现2 边框 + 背景色				f_ct f_ct_2 bor3 bg3 ?>
<?cs def:contentBoxLeftBorBgLeftImage(mod) ?>
	<?cs call:contentBoxCommonLeftImage('f_ct f_ct_2 bor3 bg3', mod) ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{comment.cs}?>
<?cs #-------------------- ?>

<?cs #:评论组件评论组件 ?>
<?cs def:randerLikeInfo(mod) ?>
	<?cs if: qz_metadata.qz_data.version==1 ?>
		<?cs if:qz_metadata.qz_data.key2.LIKE.cnt>0 ?>
			<?cs set:qz_data_key='key2' ?>
		<?cs elif:qz_metadata.qz_data.key1.LIKE.cnt>0 ?>
			<?cs set:qz_data_key='key1' ?>
		<?cs else ?>
			<?cs set:qz_data_key='key2' ?>
		<?cs /if ?>
		<?cs def:setFriend() ?>
			<?cs #:限制最多展示三个好友 ?>
			<?cs set:len=subcount(qz_metadata.qz_data[qz_data_key].LIKE.user) ?>
			<?cs if:len>20 ?>
				<?cs set:len=19 ?>
			<?cs elif:len==0&&qz_metadata.qz_data[qz_data_key].LIKE.user ?>
				<?cs call:userLink(qz_metadata.qz_data[qz_data_key].LIKE.user,'') ?>
			<?cs else ?>
				<?cs set:len=len-1 ?>
			<?cs /if ?>
			<?cs if:subcount(qz_metadata.qz_data[qz_data_key].LIKE.user[0]) ?>
				<?cs loop:i = 0, len, 1 ?>
					<?cs call:userLink(qz_metadata.qz_data[qz_data_key].LIKE.user[i],'') ?><?cs if:i<len ?>、<?cs /if ?>
				<?cs /loop ?>
			<?cs /if ?>
		<?cs /def ?>
		<?cs #:likeinfo表示好友赞的人数 ?>
		<?cs if:subcount(qz_metadata.qz_data[qz_data_key].LIKE.user)>0 ?>
			<?cs set:likeinfo=subcount(qz_metadata.qz_data[qz_data_key].LIKE.user) ?>
		<?cs elif:subcount(qz_metadata.qz_data[qz_data_key].LIKE.user[0]) ?>
			<?cs set:likeinfo = 1 ?>
		<?cs else ?>
			<?cs set:likeinfo = 0 ?>
		<?cs /if ?>
		<?cs if:likeinfo>20 ?>
			<?cs set:likeinfo=20 ?>
		<?cs /if ?>
		<?cs if:mod.like=='on'&&qz_metadata.qz_data[qz_data_key].LIKE.cnt>0 ?>
			<div class="f_like _likeInfo" likeinfo="<?cs var:likeinfo ?>">
				<i class="ui_ico icon_hand ui_ico_f qz_like_btn_v3 hand" style="cursor: pointer;"></i>
				<span class="_ilike">
					<?cs if:qz_metadata.qz_data[qz_data_key].LIKE.isliked ?>我<?cs if:qz_metadata.qz_data[qz_data_key].LIKE.cnt > 1?>和<?cs /if ?><?cs /if ?>
				</span>
				<?cs call:setFriend() ?>
				<?cs set:_randerLikeInfo_num="" ?>
				<?cs if:likeinfo>0 && (qz_metadata.qz_data[qz_data_key].LIKE.cnt-likeinfo-qz_metadata.qz_data[qz_data_key].LIKE.isliked)>0 ?>
					<?cs set:_randerLikeInfo_tmp=qz_metadata.qz_data[qz_data_key].LIKE.cnt ?>
					<?cs set:_randerLikeInfo_pre="等" ?>
					<?cs set:_randerLikeInfo_num=(_randerLikeInfo_tmp+"人") ?>
					<?cs set:_randerLikeInfo_tail="都" ?>
				<?cs elif:likeinfo<=0 ?>
						<?cs set:_randerLikeInfo_pre="" ?>
						<?cs set:_randerLikeInfo_tail="" ?>
						<?cs if:qz_metadata.qz_data[qz_data_key].LIKE.isliked>0 ?>
							<?cs set:_randerLikeInfo_tmp=(qz_metadata.qz_data[qz_data_key].LIKE.cnt-1) ?>
							<?cs if:_randerLikeInfo_tmp>=1 ?>
								<?cs set:_randerLikeInfo_num=(_randerLikeInfo_tmp+"人") ?>
							<?cs /if ?>
						<?cs elif:qz_metadata.qz_data[qz_data_key].LIKE.cnt>0 ?>
							<?cs set:_randerLikeInfo_tmp=qz_metadata.qz_data[qz_data_key].LIKE.cnt ?>
							<?cs set:_randerLikeInfo_num=(_randerLikeInfo_tmp+"人") ?>
						<?cs /if ?>
				<?cs /if ?>
				<?cs if:qz_metadata.qz_data.key2 ?>
					<?cs set:unikey=qz_metadata.qz_data.key2 ?>
				<?cs elif:qz_metadata.qz_data.key1 ?>
					<?cs set:unikey=qz_metadata.qz_data.key1 ?>
				<?cs /if ?>
				<span class="_likecnt <?cs if:likeinfo>0 ?>ui_ml5<?cs /if ?>">
					<?cs var:_randerLikeInfo_pre ?>
					<a href="javascript:;" class="c_tx _showLikeList" data-unikey="<?cs var:unikey ?>" >
						<?cs var:_randerLikeInfo_num ?>
					</a>
					<?cs var:_randerLikeInfo_tail ?>
				</span>
				觉得很赞
			</div>
		<?cs /if ?>
	<?cs /if ?>
<?cs /def ?>

<?cs def:isAuthUser() ?>
	<?cs if: qz_metadata.hdf.bitmap ?>
		<?cs if:bitmap_value_ex(qz_metadata.hdf.bitmap,52,1)>0 || bitmap_value_ex(qz_metadata.hdf.bitmap,5,1)>0 || bitmap_value_ex(qz_metadata.hdf.bitmap,7,1)>0 ?>
			<?cs set:isAuthUser_r=1 ?>
		<?cs else ?>
			<?cs set:isAuthUser_r=0 ?>
		<?cs /if ?>
	<?cs else ?>
		<?cs if: qz_metadata.noreply ?>
			<?cs set:isAuthUser_r=1 ?>
		<?cs else ?>
			<?cs set:isAuthUser_r=0 ?>
		<?cs /if ?>
	<?cs /if ?>
<?cs /def ?>
<?cs def:isAlpha() ?>
	<?cs if:bitmap_value_ex(qz_metadata.meta.bitmap,58,1)>0?>
		<?cs set:isAlpha_r=1 ?>
	<?cs else ?>
		<?cs set:isAlpha_r=0 ?>
	<?cs /if ?>
<?cs /def ?>

<?cs def:comment(mod) ?>
	<?cs #:
		/*没有targetUser，尝试解析第一个@的人作为回复对象*/
		function resolveTargerUser(con){}
	?>
	<?cs def:resolveTargerUser(commentUser,replyUser,targetUser,con,isReply) ?>

		<?cs if:subcount(targetUser) ?>
			<?cs #:自己回复自己的情况不做这逻辑 ?>
			<?cs if: (isReply && subcount(replyUser)>0 &&  targetUser.uin!=replyUser.uin) || (!isReply && targetUser.uin!=commentUser.uin)?>
				回复<?cs call:cmtUserLink(targetUser, '') ?>
				<?cs set:resolveTargerUser.hasTargetUser=1 ?>
			<?cs /if ?>
			<?cs if: subcount(con[0]) && con[0].type=="nick" && targetUser.uin==con[0].uin?>
				<?cs set:con[0].disabled=1 ?>
			<?cs /if ?>
		<?cs elif: isReply ?>
			<?cs #:如果是在回复的话，没有targetUser要先尝试解析第一个@的人作为回复对象 ?>
			<?cs #:否则默认是回复当前评论作者 ?>
			<?cs #:如果不是回复的话，就是在评论中了，无需以下逻辑 ?>
			<?cs if: subcount(con[0]) && con[0].type=="nick" ?>
				<?cs if: subcount(replyUser)>0 && con[0].uin != replyUser.uin ?>
					回复<?cs call:cmtUserLink(con[0],"") ?>
					<?cs set:con[0].disabled=1 ?>
				<?cs /if ?>
				<?cs if:subcount(replyUser)>0 && con[0].uin==replyUser.uin ?>
					<?cs set:con[0].disabled=1 ?>
				<?cs /if ?>
				<?cs set:resolveTargerUser.hasTargetUser=1 ?>
			<?cs else ?>
				<?cs set:resolveTargerUser.hasTargetUser=0 ?>
			<?cs /if ?>
			<?cs if: !resolveTargerUser.hasTargetUser && isReply && replyUser!= 0 && commentUser.uin != replyUser.uin ?>
				回复<?cs call:cmtUserLink(commentUser, '') ?>
			<?cs /if ?>
		<?cs /if ?>
		<?cs #:用完清理一下这个标志 ?>
		<?cs set:resolveTargerUser.hasTargetUser=0 ?>
	<?cs /def ?>

	<?cs if:qz_metadata.metadata.uin == qz_metadata.metadata.useruin ?>
		<?cs set:qz_isOwner = 1 ?>
	<?cs else ?>
		<?cs set:qz_isOwner = 0 ?>
	<?cs /if ?>
	<?cs if:qz_metadata.qz_data.key2.LIKE.cnt>0 ?>
		<?cs set:qz_data_key='key2' ?>
	<?cs elif:qz_metadata.qz_data.key1.LIKE.cnt>0 ?>
		<?cs set:qz_data_key='key1' ?>
	<?cs else ?>
		<?cs set:qz_data_key='key2' ?>
	<?cs /if ?>
	<?cs #:如果没有评论内容的话,这个箭头就不显示了,设计师,我们伤不起啊. ?>
	<?cs if:qz_metadata.comments.comment.0 || subcount(qz_metadata.comments.comment.0) > 0 || subcount(qz_metadata.comments.comment) > 0 || (mod.like=='on' && qz_metadata.qz_data[qz_data_key].LIKE.cnt>0)?>
		<?cs set:qz_arrow_display = '' ?>
	<?cs else ?>
		<?cs set:qz_arrow_display = 'none' ?>
	<?cs /if ?>
	<?cs def:comment_icon(cmt)?>
		<?cs if:subcount(cmt.icon) > 0?>
			<?cs if: string.length(cmt.icon.action) ?>
				<?cs set:_comment_icon.hasIcon=1 ?>
				<a href="<?cs call:ugc_url_check(cmt.icon.action,1) ?>" target="_blank">
			<?cs elif:subcount(cmt.icon.qz_popup) ?>
				<?cs set:_comment_icon.hasIcon=1 ?>
				<a 
					data-cmd="qz_popup"  
					href="javascript:void(0)" 
					data-version="<?cs var:cmt.icon.qz_popup.version ?>" 
					data-width="<?cs var:cmt.icon.qz_popup.width ?>" 
					data-height="<?cs var:cmt.icon.qz_popup.height ?>" 
					data-title="<?cs var:cmt.icon.qz_popup.title ?>" 
					data-src="<?cs var:cmt.icon.qz_popup.src ?>" 
					data-config="<?cs var:cmt.icon.qz_popup.config ?>" 
					data-env="<?cs var:cmt.icon.qz_popup.env ?>" 
					data-imagesrc = "<?cs var:cmt.icon.qz_popup.imageSrc ?>" 
					data-pickey="<?cs var:cmt.icon.qz_popup.pickey ?>" 
					data-param="<?cs var:cmt.icon.qz_popup.param ?>"
				 >
			<?cs /if ?>
			<?cs if: _comment_icon.hasIcon ?>
					<img src="<?cs var:cmt.icon.src?>" alt="" class="icon_feed_postlist_img" title="点击查看图片"/>
				</a>
			<?cs /if ?>
			<?cs set:_comment_icon.hasIcon=0 ?>
		<?cs /if?>
	<?cs /def?>
	<?cs def:comment_img(cmt) ?>
		<?cs if:subcount(cmt.icon) > 0?>
			<div class="comments_thumbnails">
			<?cs if: string.length(cmt.icon.action) ?>
				<?cs set:_comment_icon.hasIcon=1 ?>
				<a href="<?cs var:cmt.icon.action?>" target="_blank">
					<img src="<?cs var:cmt.icon.src?>" alt="" class="icon_feed_postlist_img" />
				</a>
			<?cs elif:subcount(cmt.icon.qz_popup) ?>
				<?cs set:_comment_icon.hasIcon=1 ?>
				<?cs set:_comment_icon.media.mydef_widthLimit=65 ?>
				<?cs set:_comment_icon.media.mydef_heightLimit=45 ?>
				<?cs set:_comment_icon.media.mydef_imgurl=cmt.icon.qz_popup.imageSrc ?>
				<a 
					data-cmd="qz_popup"  
					href="javascript:void(0)" 
					data-version="<?cs var:cmt.icon.qz_popup.version ?>" 
					data-width="<?cs var:cmt.icon.qz_popup.width ?>" 
					data-height="<?cs var:cmt.icon.qz_popup.height ?>" 
					data-title="<?cs var:cmt.icon.qz_popup.title ?>" 
					data-src="<?cs var:cmt.icon.qz_popup.src ?>" 
					data-config="<?cs var:cmt.icon.qz_popup.config ?>" 
					data-env="<?cs var:cmt.icon.qz_popup.env ?>" 
					data-imagesrc = "<?cs var:cmt.icon.qz_popup.imageSrc ?>" 
					data-param="<?cs var:cmt.icon.qz_popup.param ?>"
				 >
				<?cs call:ReduceImageByShortEdge(_comment_icon.media)?>
				</a>
			<?cs /if ?>
			<?cs set:_comment_icon.hasIcon=0 ?>
			</div>
		<?cs /if?>
	<?cs /def?>
<div class="feeds_comment_v2">
	<div class="f_ang_t bor2 qz_comment_arrow <?cs var:qz_arrow_display ?>">
		<div class="ang_i ang_t_d bor2"></div>
		<div class="ang_i ang_t_u bor_bg"></div>
	</div>
	<?cs call:randerLikeInfo(mod) ?>
	<?cs if:subcount(qz_metadata.comments) > 0 ?>
		<?cs set:cmtdata = qz_metadata.comments ?>
		<?cs def:comment-items(item) ?>
			<li class="comments_item bor3" data-type="commentroot" data-tid="<?cs var:item.commentid ?>" data-uin="<?cs var:item.user.uin ?>" data-nick="<?cs call:writeUserName(item.user.uin,item.user.name) ?>" data-who="<?cs var:item.user.type ?>">
				<div class="comments_item_bd">
					<div class="ui_avatar"><?cs #:头像 ?><?cs call:userIcon(item.user) ?></div>
					<div class="comments_content">
						<?cs #:昵称 ?><?cs call:cmtUserLink(item.user, '') ?><?cs call:resolveTargerUser(item.user,0,item.targetUser,item.content.con,0) ?>
						<?cs #:评论内容 ?>：						
						<?cs call:richContent(item.content) ?>
						<?cs call:comment_img(item)?>
						<div class="comments_op">
							<span class="c_tx3 ui_mr10"><?cs #:日期 ?><?cs var:item.time.text ?></span>

						<?cs if:qz_metadata.metadata.fwd_config>0 ?>
							<span class="ui_mr10"><?cs #:转发 ?>
								<a 
									data-cmd="qz_popup" 
									data-isnewtype="1" 
									href="javascript:void(0)" 
									data-version="4" 
									data-type="ForwardingBox" 
									data-needcontainer="2" 
									data-scene="comment" 
									data-src="/qzone/app/controls/forwardingBox/forwardingBoxFacade.js" 
									data-link="/qzonestyle/qzone_app/app_feeds_v1/mood_feeds.css" 
									class="c_tx ui_mr10" >
									转发
								</a>
							</span>
						<?cs /if ?>
						<?cs if:qz_metadata.metadata.reshare_config > 0?>
							<span class="ui_mr10"><?cs #:分享 ?>
							<a 
								data-cmd="qz_popup"  
								href="javascript:void(0)" 
								data-version="4" 
								data-isnewtype="1" 
								data-type="ForwardingBox" 
								data-src="/qzone/app/controls/forwardingBox/forwardingBoxFacade.js" 
								class="c_tx ui_mr10" 
								data-link="/qzonestyle/qzone_app/app_feeds_v1/mood_feeds.css">
								转发
							</a>
							</span>
						<?cs /if ?>
						<?cs if:subcount(item.qz_reply) > 0 ?>
							<a class="ui_mr10 c_tx" href="javascript:;" 
								data-cmd="qz_reply" 
								data-version="6.<?cs alt:item.qz_reply.btnstyle?>2<?cs /alt ?>" 
								data-action="<?cs var:item.qz_reply.action ?>" 
								data-param="<?cs var:item.qz_reply.param?>" 
								data-charset="<?cs var:item.qz_reply.charset ?>" 
								data-maxLength="<?cs var:item.qz_reply.maxlength ?>" 
								data-tuin="<?cs var:item.qz_reply.tuin ?>" 
								data-config="<?cs var:item.qz_reply.config ?>" 
							>回复</a>
						<?cs /if ?>

						<?cs if:subcount(item.qz_audit) > 0 ?>
							<a class="c_tx ui_mr10" 
								href="javascript:;" 
								onclick="QZONE.ICFeeds.Interface.auditPassExtend(
									{
										dataonly:1,
										src:'<?cs var:item.qz_audit.src ?>',
										param:'<?cs var:item.qz_audit.param ?>'
									})"
							>
								通过审核
							</a>
						<?cs /if ?>

						<?cs if:qz_isOwner && item.qz_delete.action ?>
							<span class="ui_mr10">
								<qz:delete action="<?cs var:item.qz_delete.action ?>" 
									param="<?cs var:item.qz_delete.param ?>">
									删除
								</qz:delete>
							</span>
						<?cs /if ?>
						</div>
					</div>

						<?cs def:reply-items(comment,item) ?>
							<li class="comments_item bor3" data-type="replyroot" data-tid="<?cs var:item.replyid ?>" data-uin="<?cs var:item.user.uin ?>"  data-nick="<?cs call:writeUserName(item.user.uin,item.user.name) ?>" data-who="<?cs var:item.user.type ?>">
								<div class="comments_item_bd">
									<div class="ui_avatar"><?cs #:头像 ?><?cs call:userIcon(item.user) ?></div>
									<div class="comments_content">
										<?cs #:昵称 ?><?cs call:cmtUserLink(item.user, '') ?>
										<?cs call:resolveTargerUser(comment.user,item.user, item.targetUser, item.content.con,1) ?>
										<?cs #:评论内容 ?> : <?cs call:richContent(item.content) ?>
										<div class="comments_op">
											<span class="c_tx3 ui_mr10"><?cs #:日期 ?><?cs var:item.time.text ?></span>

										<?cs if:qz_metadata.metadata.fwd_config>1 ?>
											<span class="ui_mr10">
												<a 
													data-cmd="qz_popup" 
													href="javascript:void(0)" 
													data-version="4" 
													data-isnewtype="1" 
													data-type="ForwardingBox" 
													data-needcontainer="2" 
													data-scene="reply" 
													data-src="/qzone/app/controls/forwardingBox/forwardingBoxFacade.js" 
													class="c_tx ui_mr10" 
													data-link="/qzonestyle/qzone_app/app_feeds_v1/mood_feeds.css"
												>
													转
												</a>
											</span>
										<?cs /if ?>
										<?cs if:qz_metadata.metadata.reshare_config > 1 ?>
											<span class="ui_mr10"><?cs #:分享 ?>
												<a 
													data-cmd="qz_popup"  
													href="javascript:void(0)" 
													data-version="4" 
													data-isnewtype="1" 
													data-type="ForwardingBox" 
													data-src="/qzone/app/controls/forwardingBox/forwardingBoxFacade.js" 
													class="c_tx ui_mr10" 
													style="margin-right:0;" 
													data-link="/qzonestyle/qzone_app/app_feeds_v1/mood_feeds.css">
													转
												</a>
											</span>
										<?cs /if ?>
										<?cs if:subcount(item.qz_reply) > 0 ?>
											<a class="ui_mr10 c_tx" href="javascript:;" 
												data-cmd="qz_reply" 
												data-version="6.4" 
												data-action="<?cs var:item.qz_reply.action ?>" 
												data-param="<?cs var:item.qz_reply.param?>" 
												data-charset="<?cs var:item.qz_reply.charset ?>" 
												data-maxLength="<?cs var:item.qz_reply.maxlength ?>" 
												data-tuin="<?cs var:item.qz_reply.tuin ?>" 
												data-config="<?cs var:item.qz_reply.config ?>" 
											>回复</a>
										<?cs /if ?>

										<?cs if:subcount(item.qz_audit) > 0 ?>
											<a class="c_tx ui_mr10" 
												href="javascript:;" 
												onclick="QZONE.ICFeeds.Interface.auditPassExtend(
													{
														dataonly:1,
														src:'<?cs var:item.qz_auidit.src ?>',
														param:'<?cs var:item.qz_audit.param ?>'
													})"
											>
												通过审核
											</a>
										<?cs /if ?>

										<?cs if:qz_isOwner && item.qz_delete.action ?>
											<span class="ui_mr10">
												<qz:delete 
													action="<?cs var:item.qz_delete.action ?>" 
													param="<?cs var:item.qz_delete.param ?>"
												>删除</qz:delete>
											</span>
										<?cs /if ?>
									</div>
								</div>
							</div>
						</li>
					<?cs /def ?>
					<?cs if:qz_metadata.qz_data.feedtype !=1 && isAuthUser_r==1 && item.reply_count && item.reply_count>=0 ?>
						<?cs set:reply_loop=1 ?>
						<?cs set:reply_count=item.reply_count ?>
					<?cs elif:(qz_metadata.qz_data.feedtype==1||!isAuthUser_r) && (item.replies.reply.0 || subcount(item.replies.reply.0) > 0)?>
						<?cs set:reply_count=subcount(item.replies.reply) ?>
					<?cs elif:(qz_metadata.qz_data.feedtype==1||!isAuthUser_r) && subcount(item.replies.reply) > 0 ?>
						<?cs set:reply_count=1 ?>
					<?cs else ?>
						<?cs set:reply_count=0 ?>
					<?cs /if ?>

					<?cs if:reply_count > 0 ?>
					<div class="comments_list mod_comments_sub">
						<?cs if:item.replies.qz_more.action ?>
							<div class="comments_list_more">
								<a href="javascript:;" class="c_tx"
									 data-cmd="qz_more"
									 data-action="<?cs var:item.replies.qz_more.action?>"
									 data-param="<?cs var:item.replies.qz_more.param?>"
									 data-charset="<?cs var:item.replies.qz_more.charset?>"
								>
									展开剩余<?cs var:item.replies.qz_more.count ?>条回复
								</a>
							</div>
						<?cs /if ?>
						<?cs if:item.replies.qz_more.url ?>
							<div class="comments_list_more">
								<a href="<?cs call:ugc_url_check(item.replies.qz_more.url,1) ?>" class="c_tx" target="_blank">
									查看剩余<?cs var:item.replies.qz_more.count ?>条回复
								</a>
							</div>
						<?cs /if ?>
						<ul>

						<?cs if:reply_count >1||(reply_count==1 && qz_metadata.qz_data.feedtype!=1&&isAuthUser_r==1) ?>
							<?cs if:!qz_metadata.comments.commLimit ?>
								<?cs set:qz_metadata.comments.commLimit=3 ?>
							<?cs /if ?>
							<?cs if:reply_count>qz_metadata.comments.commLimit ?>
								<?cs set:loopcount=reply_count-qz_metadata.comments.commLimit ?>
							<?cs else ?>
								<?cs set:loopcount=0 ?>
							<?cs /if ?>
							<?cs loop:i =loopcount, reply_count-1, 1 ?>
								<?cs call:reply-items(item,item.replies.reply[i]) ?>
							<?cs /loop ?>
						<?cs elif:reply_count > 0 ?>
							<?cs call:reply-items(item,item.replies.reply) ?>
						<?cs /if ?>
						</ul>
					</div>
					<?cs /if ?>
				</div>
			</li>
		<?cs /def ?>
		<?cs if:qz_metadata.qz_data.feedtype!=1&&isAuthUser_r==1 && qz_metadata.comments.comment_count && qz_metadata.comments.comment_count>=0 ?>
			<?cs set:commont_num=qz_metadata.comments.comment_count ?>
			<?cs set:commont_loop=1 ?>
		<?cs elif:(qz_metadata.qz_data.feedtype==1||!isAuthUser_r) &&( qz_metadata.comments.comment.0 || subcount(qz_metadata.comments.comment.0) > 0 ) ?>
			<?cs set:commont_num=subcount(qz_metadata.comments.comment) ?>
		<?cs elif:(qz_metadata.qz_data.feedtype==1||!isAuthUser_r) && subcount(qz_metadata.comments.comment) > 0 ?>
			<?cs set:commont_num=1 ?>
		<?cs else ?>
			<?cs set:commont_num=0 ?>
		<?cs /if ?>
		<?cs if:commont_num>0 ?> 
			<div class="mod_comments"> 
				<?cs #:这里如果是认证空间,要把节点隐藏掉,避免空节点 ?>
				<?cs #:如果没有好友评论就隐藏吧 ?>

				<div class="comments_list <?cs if:isAuthUser_r==1 && commont_num==0 ?>none<?cs /if ?>">
					<?cs if:qz_metadata.totalcomment > 3 && qz_metadata.comments.qz_more.action ?>
						<div class="comments_list_more">
							<a href="javascript:;" class="c_tx comments_more_entry"
								 data-cmd="qz_more"
								 data-action="<?cs var:qz_metadata.comments.qz_more.action?>"
								 data-param="<?cs var:qz_metadata.comments.qz_more.param?>"
								 data-charset="<?cs var:qz_metadata.comments.qz_more.charset?>"
							>
								展开剩余<?cs var:qz_metadata.comments.qz_more.count ?>条评论
							</a>
						</div>
					<?cs /if ?>
					<?cs if:(qz_metadata.metadata.appid==311  || qz_metadata.metadata.appid==4) ?>
						<?cs if:(isAuthUser_r==1 && commont_num < qz_metadata.totalcomment 
									&& qz_metadata.comments.qz_more.url)
								||(isAuthUser_r==0 &&qz_metadata.comments.qz_more.url) ?>
							<div class="comments_list_more">
								<a href="<?cs call:ugc_url_check(qz_metadata.comments.qz_more.url,1) ?>" class="c_tx" 
									 target="_blank">
								查看剩余全部评论
								</a>
							</div>
						<?cs /if ?>
					<?cs else ?>
						<?cs if:!isAuthUser_r && qz_metadata.comments.qz_more.url ?>
							<div class="comments_list_more">
								<a href="<?cs call:ugc_url_check(qz_metadata.comments.qz_more.url,1) ?>" 
									class="c_tx" target="_blank">
									查看剩余<?cs var:qz_metadata.comments.qz_more.count ?>条评论
								</a>
							</div>
						<?cs /if ?>
					<?cs /if ?>
					<?cs if:commont_num > 1  || (commont_num==1&&qz_metadata.qz_data.feedtype!=1&&isAuthUser_r==1) ?>
						<?cs if:!qz_metadata.comments.commLimit ?>
							<?cs set:qz_metadata.comments.commLimit=3 ?>
						<?cs /if ?>
						<?cs if:commont_num>qz_metadata.comments.commLimit ?>
							<?cs set:loopcount=commont_num-qz_metadata.comments.commLimit ?>
						<?cs else ?>
							<?cs set:loopcount=0 ?>
						<?cs /if ?>
						<ul>
						<?cs loop:i = loopcount, commont_num-1, 1 ?>
							<?cs call:comment-items(qz_metadata.comments.comment[i]) ?>
						<?cs /loop ?>
						</ul>
					<?cs elif:commont_num > 0 ?>
						<ul>
							<?cs call:comment-items(qz_metadata.comments.comment) ?>
						</ul>
					<?cs /if ?>
				</div>
			</div>
		<?cs /if ?>
		<?cs if:subcount(qz_metadata.comments.qz_reply) > 0 ?> 
				<div class="mod_commnets_poster bg2 feedClickCmd comment_default_inputentry"
					 data-version="6"
					 data-cmd="qz_reply"
					 data-action="<?cs var:qz_metadata.comments.qz_reply.action ?>"
					 data-param="<?cs var:qz_metadata.comments.qz_reply.param ?>"
					 data-charset="<?cs var:qz_metadata.comments.qz_reply.charset ?>"
					 data-maxLength="<?cs var:qz_metadata.comments.qz_reply.maxlength ?>"
					 data-tuin="<?cs var:qz_metadata.comments.qz_reply.tuin ?>"
					 data-config="<?cs var:qz_metadata.comments.qz_reply.config ?>"
					 data-typeid="<?cs if:qz_reply_input_cgi_type.ret ?>1<?cs /if?>"
				>
					<div class="comments_poster_bd comments_poster_default">
						<div class="comments_box">
							<div class="textinput textinput_default bor2" 
								 alt="replybtn"
								 placeholder="我也说一句"
							>
								<a class="c_tx3" href="javascript:void(0);" alt="replybtn">我也说一句</a>
							</div>
							<div class="mod-quick-comment bor2">
								<a href="javascript:;" data-cmd="qz_quick_reply" class="btn-quick-comment bg4"><i class="icon-flash"></i><span class="flash-text c_tx3">快评</span></a>
							</div>
						</div>
					</div>
				</div>
		<?cs /if ?>
	<?cs /if ?>
</div>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{qz_data.cs}?>
<?cs #-------------------- ?>

<?cs def:qzData() ?>
	<?cs #:key1是节点key key2是源节点key  gdt_key 是广点通?>
	<?cs if:subcount(qz_metadata.qz_data) > 0 || qz_metadata.gdt_url ?>
		<qz:data 
			<?cs if:qz_metadata.qz_data.version==1 ?>
				version="<?cs var:qz_metadata.qz_data.version ?>" 
			<?cs /if ?>
			<?cs if:qz_metadata.qz_data.key1 ?>
				key1="<?cs var:qz_metadata.qz_data.key1 ?>" 
			<?cs /if ?>
			<?cs if:qz_metadata.qz_data.key2 ?>
				key2="<?cs var:qz_metadata.qz_data.key2 ?>" 
			<?cs /if ?>
			<?cs if:qz_metadata.metadata.gdt_url ?>
				gdt_key="<?cs var:qz_metadata.metadata.gdt_url ?>" 
			<?cs /if ?>
			/>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{main_summary.cs}?>
<?cs #-------------------- ?>

<?cs #:一级元件召唤 ?>
<?cs def:modCaller(summaryMod) ?>
	<?cs def:mods(mod) ?>
		<?cs if:mod.name == "quote" ?>
			<?cs call:quote(mod) ?>
		<?cs elif:mod.name == "contentBox" ?>
			<?cs call:contentBox(mod) ?>
		<?cs elif:mod.name == 'contentBoxLeftBor' ?>
			<?cs call:contentBoxLeftBor(mod) ?>
		<?cs elif:mod.name == 'contentBoxLeftBorBg' ?>
			<?cs call:contentBoxLeftBorBg(mod) ?>
		<?cs elif:mod.name == 'contentBoxLeftImage' ?>
			<?cs call:contentBoxLeftImage(mod) ?>
		<?cs elif:mod.name == 'contentBoxLeftBorLeftImage' ?>
			<?cs call:contentBoxLeftBorLeftImage(mod) ?>
		<?cs elif:mod.name == 'contentBoxLeftBorBgLeftImage' ?>
			<?cs call:contentBoxLeftBorBgLeftImage(mod) ?>
		<?cs elif:mod.name == "opr" ?>
			<?cs call:opr(mod) ?>
		<?cs elif:mod.name == "comment" ?>
			<?cs call:comment(mod) ?>
		<?cs elif:mod.name == "voteViewer" ?>
			<?cs call:voteViewer(mod) ?>
		<?cs elif:mod.name == "locationInfo" ?>
			<?cs call:locationInfo(mod) ?>
		<?cs /if ?>
	<?cs /def ?>
	<?cs if:summaryMod.source_in_content ?><?cs set:source_in_content=1?><?cs /if?>
	<?cs #:这个来判断是否数组的方法,从来就没有爽过 叼~~?>
	<?cs if:subcount(summaryMod.mod.0) > 0 ?>
		<?cs each:mod = summaryMod.mod ?>
			<?cs call:mods(mod) ?>
		<?cs /each ?>
	<?cs else ?>
		<?cs call:mods(summaryMod.mod) ?>
	<?cs /if ?>
	<?cs #:异步化数据key ?>
	<?cs call:qzData() ?>
<?cs /def ?>

<?cs #:fkey准备改名为tid ?>
<?cs #:origfkey准备改名为origtid ?>


<?cs #-------------------- ?>
<?cs #{mod_layout.cs}?>
<?cs #-------------------- ?>

<?cs #从布局版本开始执行?>
<?cs def:start(module) ?>
	<?cs def:versionCaller(mod,ver) ?>
		<?cs #只有存在多版本布局时，前面的假设成立?>
		<?cs set:layout_v = "layout_v" + ver ?>
		<?cs if:subcount(mod[layout_v]) > 0 ?>
			<?cs call:modCaller(mod[layout_v]) ?>
		<?cs else ?>
			<?cs call:modCaller(mod) ?>
		<?cs /if ?>
	<?cs /def ?>

	<?cs def:initConfig(mod, ver) ?>
		<?cs #:初始化配置项目 ?>
		<?cs if:subcount(mod[layout_v]) > 0 ?>
				<?cs set:qz_config = mod[layout_v].config ?>
		<?cs else ?>
				<?cs set:qz_config = mod.config ?>
		<?cs /if ?>
	<?cs /def ?>

	<?cs #假设所有feed的存在布局版本?>
	<?cs set:qz_layout_version = 1 ?>
	<?cs if:qz_metadata.layout_version[module] ?>
		<?cs set:qz_layout_version = qz_metadata.layout_version[module] ?>
	<?cs /if?>
	<?cs if:module == "summary" ?>
		<?cs call:versionCaller(qz_metadata.qz_layout_summary, qz_layout_version) ?>
		<?cs call:initConfig(qz_metadata.qz_layout_summary, qz_layout_version) ?>
	<?cs elif:module == "title" ?>
		<?cs call:versionCaller(qz_metadata.qz_layout_title, qz_layout_version) ?>
	<?cs /if ?>
<?cs /def ?>


<?cs #-------------------- ?>
<?cs #{summary_start.cs}?>
<?cs #-------------------- ?>
<?cs set:qz_reply_input_cgi_type_map['2_2']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['4_7']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['4_4']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['4_10']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['4_14']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['4_18']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['4_27']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['202_1']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['202_12']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['202_13']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['311_2']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['334_0']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['334_1']=1 ?>
<?cs set:qz_reply_input_cgi_type_map['334_2']=1 ?>
<?cs #:
	/**/
	function qz_reply_input_cgi_type(){}
?>
<?cs def:qz_reply_input_cgi_type() ?>
	<?cs set:_key=qz_metadata.metadata.appid+'_'+qz_metadata.qz_data.typeid ?>
	<?cs if: qz_reply_input_cgi_type_map[_key] ?>
		<?cs set:qz_reply_input_cgi_type.ret=1 ?>
	<?cs /if ?>
<?cs /def ?>

<?cs ##########是否多图的映射 ?>
<?cs set:hasImages_map["4"]=1 ?>
<?cs set:hasImages_map["4"]["0"]=1 ?>
<?cs set:hasImages_map["4"]["7"]=1 ?>
<?cs set:hasImages_map["4"]["9"]=1 ?>
<?cs set:hasImages_map["4"]["16"]=1 ?>
<?cs set:hasImages_map["4"]["21"]=1 ?>
<?cs set:hasImages_map["4"]["24"]=1 ?>
<?cs set:hasImages_map["4"]["25"]=1 ?>
<?cs set:hasImages_map["4"]["27"]=1 ?>
<?cs set:hasImages_map["4"]["28"]=1 ?>

<?cs ##########多图的值 ?>
<?cs set:hasImages_value_map["4"]=1 ?>
<?cs set:hasImages_value_map["4"]["p11"]=304 ?><?cs #被动多图的值 ?>
<?cs set:hasImages_value_map["4"]["p10"]=303 ?><?cs #被动单图的值 ?>
<?cs set:hasImages_value_map["4"]["p00"]=301 ?><?cs #主动动单图的值 ?>
<?cs set:hasImages_value_map["4"]["p01"]=302 ?><?cs #主动动单图的值 ?>
<?cs #
	是否多图feeds
?>
<?cs def:hasImages() ?>
	<?cs if: hasImages_map[qz_metadata.metadata.appid] ?>
		<?cs set:_images=hasImages_map[qz_metadata.metadata.appid][qz_metadata.qz_data.typeid] ?>
		<?cs if: !_images ?>
			<?cs set:_images=0 ?>
		<?cs /if ?>
		<?cs if: hasImages_value_map[qz_metadata.metadata.appid] ?>
			<?cs set:hasImages.ret=hasImages_value_map[qz_metadata.metadata.appid]["p"+qz_metadata.qz_data.feedtype+_images] ?>
		<?cs /if ?>
	<?cs /if ?>
	<?cs if: !hasImages.ret ?>
		<?cs set:hasImages.ret=0 ?>
	<?cs /if ?>
<?cs /def ?>

<?cs #:fkey准备改名为tid ?>
<?cs #:origfkey准备改名为origtid ?>
<?cs def:genFeedsData() ?>
	<i class="none" name="feed_data" 
		data-bitmap="<?cs var:qz_metadata.hdf.bitmap ?>" 
		data-yybitmap="<?cs var:qz_metadata.hdf.yybitmap ?>" 
		data-fkey="<?cs var:qz_metadata.metadata.feedkey ?>" 
		data-abstime="<?cs var:qz_metadata.time.abstime ?>" 
		<?cs if: qz_metadata.metadata.topicid ?>
			data-topicid="<?cs var:qz_metadata.metadata.topicid ?>" 
		<?cs /if ?>
		<?cs if: qz_metadata.metadata.appid!=4 ?>
			data-tid="<?cs var:qz_metadata.metadata.blogid ?>" 
		<?cs else ?>
			data-tid="<?cs var:qz_metadata.content_box.media.albumid ?>" 
			<?cs if: subcount(qz_metadata.content_box.media.media.0)==0 && subcount(qz_metadata.content_box.media.media)>0 ?>
				<?cs #:只有一张照片，当它就是照片feeds ?>
				data-subid="<?cs var:qz_metadata.content_box.media.media.largeid ?>" 
			<?cs /if ?>
		<?cs /if ?>
		data-uin="<?cs var:qz_metadata.metadata.uin ?>" 
		data-totweet="<?cs var:qz_metadata.metadata.to_tweet ?>" 
		data-origfkey="<?cs if:qz_metadata.metadata.orgid.0 ?><?cs var:qz_metadata.metadata.orgid.0 ?><?cs elif:qz_metadata.metadata.orgid ?><?cs var:qz_metadata.metadata.orgid ?><?cs /if ?>" 
		data-origtid="<?cs if:qz_metadata.metadata.orgid.0 ?><?cs var:qz_metadata.metadata.orgid.0 ?><?cs elif:qz_metadata.metadata.orgid ?><?cs var:qz_metadata.metadata.orgid ?><?cs /if ?>" 
		data-origuin="<?cs var:qz_metadata.metadata.orguin ?>" 
		data-issignin="<?cs var:qz_metadata.metadata.signin ?>" 
		data-source="<?cs var:qz_metadata.metadata.mood_source ?>" 
		data-retweetcount="<?cs if:qz_metadata.qz_data.key2.ZS.cnt ?><?cs var:qz_metadata.qz_data.key2.ZS.cnt?><?cs elif:qz_metadata.qz_data.key1.ZS.cnt ?><?cs var:qz_metadata.qz_data.key1.ZS.cnt ?><?cs else ?>0<?cs /if ?>" 
		<?cs if: hasImages.ret!=0 ?>
		 	data-images=<?cs var:hasImages.ret ?> 
		 <?cs /if ?> 
	></i>
<?cs /def ?>
<?cs if: !qz_metadata.qz_data.feedtype ?>
	<?cs set:qz_metadata.qz_data.feedtype=0 ?>
<?cs /if ?>
<?cs call:qz_reply_input_cgi_type() ?>
<?cs call:hasImages() ?>
<?cs #:这里自动call一下这个，则全文都能直接使用isAuthUser_r来判断当前用户是否认证空间 ?>
<?cs call:isAuthUser() ?>
<?cs call:isAlpha() ?>
<?cs call:genFeedsData() ?>
<?cs #主入口?>
<?cs call:start("summary")?>
<span class="none feed_log_data" 
	<?cs if:string.length(qz_metadata.metadata.srctype) > 0 ?>
		<?cs if:string.length(qz_metadata.metadata.feedoz) > 0 ?>
			srctype="<?cs var:qz_metadata.metadata.srctype ?>"
			<?cs set:srctype = 1000 + qz_metadata.metadata.srctype ?>
			data-showlog="<?cs var:qz_metadata.metadata.feedoz ?>|202_<?cs var:srctype ?>" 
			data-stat="<?cs var:qz_metadata.metadata.feedstat ?>|202_<?cs var:srctype ?>" 
		<?cs /if ?>
	<?cs else ?>
		<?cs if:string.length(qz_metadata.metadata.feedoz) > 0 ?>
			data-showlog="<?cs var:qz_metadata.metadata.feedoz ?>" 
			data-stat="<?cs var:qz_metadata.metadata.feedstat ?>" 
		<?cs /if ?>
	<?cs /if ?>
	<?cs if:qz_metadata.metadata.orguin ?>
		data-original="<?cs var:qz_metadata.metadata.orguin ?>" 
	<?cs elif:qz_metadata.metadata.shareorguin ?>
		data-original="<?cs var:qz_metadata.metadata.shareorguin ?>" 
	<?cs /if ?>
	<?cs if:string.length(qz_metadata.metadata.feedstat)>0 ?>
		data-stat="<?cs var:qz_metadata.metadata.feedstat ?>" 
	<?cs /if ?>
>
</span>
